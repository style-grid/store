<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category - Style Grid</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fugaz+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />

    <style>
    /* --- সম্পূর্ণ CSS কোড --- */
    :root {
        --bg-primary: #FFFFFF; 
        --bg-secondary: #F7F7F7; 
        --text-primary: #121212; 
        --text-secondary: #666666; 
        --accent-color: #FF6F61; 
        --card-bg: #FFFFFF; 
        --card-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
        --header-bg: #1e1e1e; 
        --header-text: #FFFFFF;
    }
    body.dark-mode {
        --bg-primary: #121212;
        --bg-secondary: #1e1e1e;
        --text-primary: #e0e0e0;
        --text-secondary: #aaaaaa;
        --card-bg: #2d2d2d; 
        --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        --header-bg: #000000;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
        font-family: 'Roboto', sans-serif; background-color: var(--bg-secondary); 
        color: var(--text-primary); margin: 0; padding: 0; min-height: 100vh; 
        display: flex; flex-direction: column; transition: background-color 0.3s, color 0.3s;
    }
    #main-content {
        flex-grow: 1; max-width: 1400px; margin: 0 auto; width: 100%;
    }
    .sticky-header-top { 
        position: sticky; top: 0; z-index: 1000;
        background-color: var(--header-bg); width: 100%;
    }
    /* পরিবর্তন: হেডার স্টাইল index.html এর সাথে মিলানো হয়েছে */
    .header {
        background-color: var(--header-bg); color: var(--header-text);
        padding: 8px 20px; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        display: flex; justify-content: space-between; align-items: center;
        max-width: 1400px; margin: 0 auto;
    }
    .header-left { display: flex; align-items: center; gap: 8px; }
    .website-icon i { font-size: 24px; color: var(--accent-color); }
    .website-name { font-size: 24px; font-weight: 900; font-family: 'Fugaz One', cursive; white-space: nowrap; }
    .name-part-1 { color: var(--accent-color); }
    .name-part-2 { color: var(--header-text); }
    .header-right { display: flex; align-items: center; gap: 15px; }
    .social-icon { color: var(--header-text); font-size: 20px; transition: color 0.3s; text-decoration: none; }
    .social-icon:hover { color: var(--accent-color); }

    /* ক্যাটাগরি হেডারের জন্য বিশেষ স্টাইল */
    .category-header {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 20px;
        background-color: var(--bg-primary);
        border-bottom: 1px solid rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    body.dark-mode .category-header {
        border-bottom: 1px solid #3a3a3a;
    }
    .category-header-image {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        overflow: hidden;
        border: 3px solid var(--accent-color);
        flex-shrink: 0;
        background-color: var(--bg-secondary);
    }
    .category-header-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .category-header-title {
        font-size: 28px;
        font-weight: 700;
        font-family: 'Roboto', sans-serif;
    }
    
    .container {
        display: grid; grid-template-columns: repeat(4, 1fr); 
        gap: 20px; padding: 0 20px 20px 20px; max-width: 1400px; margin: 0 auto;
    }
    .card {
        background-color: var(--card-bg); border-radius: 8px; box-shadow: var(--card-shadow);
        overflow: hidden; display: flex; flex-direction: column; 
        text-decoration: none;
        transition: transform 0.2s ease, box-shadow 0.3s ease; cursor: pointer;
    }
    .card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.15); }
    .card-image-container { height: 200px; background-color: var(--bg-secondary); }
    .card-image-container img { width: 100%; height: 100%; object-fit: cover; }
    .card-content { padding: 15px; display: flex; flex-direction: column; flex-grow: 1; }
    .card-title {
        font-size: 16px; font-weight: 600; color: var(--text-primary); 
        margin: 0 0 10px 0; line-height: 1.4; height: 45px;
        overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
    }
    .card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
    .card-rating {
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
        color: var(--text-secondary);
    }
    .card-price { font-size: 18px; font-weight: 700; color: var(--text-primary); white-space: nowrap; }
    #loader {
        text-align: center;
        padding: 20px;
        font-size: 18px;
        color: var(--text-secondary);
        display: none;
    }
    
    @media (max-width: 767px) {
        /* পরিবর্তন: মোবাইল হেডার স্টাইল index.html এর সাথে মিলানো হয়েছে */
        .header { padding: 6px 15px; }
        .website-icon i { font-size: 20px; }
        .website-name { font-size: 20px; }
        .header-right { gap: 12px; }
        .header-right .social-icon { font-size: 18px; }
        .category-header { padding: 15px; gap: 15px; }
        .category-header-image { width: 60px; height: 60px; }
        .category-header-title { font-size: 22px; }
        .container { grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 10px 10px 10px; }
        .card-image-container { height: 180px; }
        .card-title { font-size: 14px; height: 39px; }
    }
    </style>
</head>
<body>
    <div class="sticky-header-top">
        <header class="header">
            <a href="index.html" style="display: flex; align-items: center; text-decoration: none; color: inherit;">
                <div class="website-icon"><i class="fas fa-shopping-bag"></i></div>
                <div class="website-name"><span class="name-part-1">STYLE</span><span class="name-part-2">GRID</span></div>
            </a>
            <!-- পরিবর্তন: ডার্ক/লাইট মোড বাটনটি সরানো হয়েছে -->
            <div class="header-right">
                <a href="#" class="social-icon" data-social="facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="social-icon" data-social="instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" class="social-icon" data-social="pinterest"><i class="fab fa-pinterest-p"></i></a>
                <a href="#" class="social-icon" data-social="whatsapp"><i class="fab fa-whatsapp"></i></a>
            </div>
        </header>
    </div>
    
    <main id="main-content">
        <div id="category-header-container"></div>
        <div class="container" id="product-grid"></div>
        <div id="loader"><i class="fas fa-spinner fa-spin"></i> Loading More...</div>
    </main>
    
    <script>
        const SOCIAL_LINKS = {
            facebook: "https://facebook.com/your-page-url",
            instagram: "https://instagram.com/your-username",
            pinterest: "https://pinterest.com/your-username",
            whatsapp: "https://wa.me/8801234567890"
        };
        const CATEGORIES = {
            'Men': { 
                'm-shirts': "T-Shirts & Polos", 'm-pants': "Jeans & Pants", 'm-outer': "Outerwear",
                'm-shoes': "Shoes", 'm-acc': "Accessories"
            },
            'Women': {
                'f-dresses': "Dresses", 'f-tops': "Tops & Blouses", 'f-bottoms': "Jeans & Leggings",
                'f-active': "Activewear", 'f-jewelry': "Jewelry & Bags"
            }
        };
        let currentMode = localStorage.getItem('mode') || 'light';
        let allCategoryProducts = [];
        let loadedItemsCount = 0;
        const BATCH_SIZE = 8;

        async function fetchCategoryProducts(categoryId) {
            try {
                const response = await fetch(`data/${categoryId}.json`);
                if (!response.ok) throw new Error(`Could not fetch data/${categoryId}.json`);
                const products = await response.json();
                return products.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            } catch (error) {
                console.error("Error fetching category products:", error);
                document.getElementById('main-content').innerHTML = `<h2 style="text-align: center; padding: 40px;">Could not load products. Please try again later.</h2>`;
                return null;
            }
        }

        function renderCategoryHeader(products, categoryId) {
            const container = document.getElementById('category-header-container');
            const allCategoryNames = {...CATEGORIES.Men, ...CATEGORIES.Women};
            const categoryName = allCategoryNames[categoryId];
            if (!container || !products || products.length === 0) return;
            const latestProductImage = products[0].images[0];
            container.innerHTML = `
                <div class="category-header">
                    <div class="category-header-image">
                        <img src="${latestProductImage}" alt="${categoryName}">
                    </div>
                    <h1 class="category-header-title">${categoryName}</h1>
                </div>`;
            document.title = `${categoryName} - Style Grid`;
        }

        function renderProductBatch() {
            const grid = document.getElementById('product-grid');
            const loader = document.getElementById('loader');
            const batch = allCategoryProducts.slice(loadedItemsCount, loadedItemsCount + BATCH_SIZE);
            if (batch.length === 0) {
                loader.style.display = 'none';
                return;
            }
            const productsHtml = batch.map(product => `
                <a href="product.html#${product.category}/${product.id}" class="card">
                    <div class="card-image-container">
                        <img src="${product.images[0]}" alt="${product.title}" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">${product.title}</h3>
                        <div class="card-footer">
                            <div class="card-rating">
                                <i class="fas fa-star" style="color: #FFC107;"></i>
                                <span>${product.rating}</span>
                            </div>
                            <div class="card-price">$${product.price}</div>
                        </div>
                    </div>
                </a>
            `).join('');
            grid.insertAdjacentHTML('beforeend', productsHtml);
            loadedItemsCount += batch.length;
            if (loadedItemsCount >= allCategoryProducts.length) {
                loader.style.display = 'none';
            } else {
                loader.style.display = 'block';
            }
        }

        // পরিবর্তন: ডার্ক মোড ফাংশনটি এখন আর আইকন পরিবর্তন করবে না
        function setMode(mode) {
            document.body.classList.toggle('dark-mode', mode === 'dark');
            localStorage.setItem('mode', mode);
            currentMode = mode;
        }
        function setupSocialLinks() {
            document.querySelectorAll('.social-icon[data-social]').forEach(iconLink => {
                const platform = iconLink.dataset.social;
                if (SOCIAL_LINKS[platform]) {
                    iconLink.href = SOCIAL_LINKS[platform];
                    iconLink.target = "_blank";
                    iconLink.rel = "noopener noreferrer";
                }
            });
        }

        function setupInfiniteScroll() {
            const loader = document.getElementById('loader');
            if (!loader) return;
            const observer = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting && loadedItemsCount < allCategoryProducts.length) {
                    renderProductBatch();
                }
            }, { rootMargin: "0px 0px 300px 0px" });
            observer.observe(loader);
        }

        async function initializePage() {
            setMode(currentMode);
            setupSocialLinks();
            const categoryId = window.location.hash.substring(1);
            if (!categoryId) {
                document.getElementById('main-content').innerHTML = `<h2 style="text-align: center; padding: 40px;">No category specified. Please return to the <a href="index.html">homepage</a>.</h2>`;
                return;
            }
            allCategoryProducts = await fetchCategoryProducts(categoryId);
            if (allCategoryProducts && allCategoryProducts.length > 0) {
                renderCategoryHeader(allCategoryProducts, categoryId);
                renderProductBatch(); 
                setupInfiniteScroll(); 
            }
        }

        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
