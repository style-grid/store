<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StyleGrid | The Curated Fashion Lookbook - High Speed Affiliate</title>
    
    <style>
        /* ======================================= */
        /* === DESKTOP & BASE STYLES (Color Grading & Layout) === */
        /* ======================================= */
        :root {
            --primary-color: #333333;
            --accent-color: #FF6F61; /* Fashion Red */
            --card-bg: #FFFFFF;
            --bg-color: #F4F7F6;
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-color: #e0e0e0;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: var(--bg-color); color: var(--primary-color); }
        a { text-decoration: none; color: var(--accent-color); }
        .container { max-width: 1300px; margin: 0 auto; padding: 0 20px; }
        .hidden { display: none !important; }

        /* --- Header Section (Sticky) --- */
        .main-header { display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; background-color: var(--card-bg); box-shadow: var(--shadow-light); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border-color); }
        .header-left { display: flex; align-items: center; gap: 20px; }
        .header-left .cart-icon { font-size: 24px; cursor: pointer; color: var(--accent-color); }
        .header-left .logo { font-size: 26px; font-weight: 800; color: var(--primary-color); }
        .admin-btn { padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background-color 0.3s; margin-left: 20px; }
        .admin-btn:hover { background-color: #0056b3; }
        .social-icons a { margin-left: 15px; font-size: 18px; color: var(--primary-color); transition: color 0.3s; }
        .social-icons a:hover { color: var(--accent-color); }

        /* --- Slider Section (16:9) --- */
        .slider-section { padding: 20px 0; background-color: #222; overflow: hidden; }
        .slider-container { display: flex; transition: transform 0.5s ease-in-out; height: 500px; }
        .slider-item { flex: 0 0 100%; position: relative; }
        .slider-item img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .slider-caption { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: white; background: rgba(0, 0, 0, 0.7); padding: 10px 20px; border-radius: 5px; font-size: 24px; font-weight: 600; }

        /* --- Category Grid Section --- */
        .category-grid h2 { text-align: center; margin-top: 40px; color: var(--primary-color); }
        .categories-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 40px; padding: 30px 0; }
        .category-item { cursor: pointer; text-align: center; flex: 0 0 120px; transition: transform 0.3s; }
        .category-item:hover { transform: translateY(-5px); }
        .cat-icon {
            width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 10px;
            background-size: cover; background-position: center; border: 4px solid var(--accent-color);
        }

        /* --- Category View & Product Card (Flipkart Style) --- */
        #category-view { padding: 40px 20px; }
        .category-header-title { text-align: center; margin-bottom: 30px; }
        .category-header-title h2 { margin-top: 10px; font-size: 28px; }
        
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        .product-card { background: var(--card-bg); border-radius: 10px; box-shadow: var(--shadow-light); overflow: hidden; position: relative; cursor: pointer; }
        .card-image-slider { position: relative; height: 350px; overflow: hidden; }
        .card-image-wrapper { display: flex; width: 100%; height: 100%; transition: transform 0.5s ease-in-out; }
        .card-image { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; }
        .card-content { padding: 15px; }
        .card-rating { font-size: 14px; color: #28a745; margin-bottom: 5px; }
        .card-rating span.stars { color: orange; margin-right: 5px; font-size: 1.1em; }
        .card-title { font-size: 18px; margin: 0 0 10px 0; font-weight: 600; min-height: 40px; }
        .share-icon { position: absolute; top: 15px; right: 15px; background: rgba(255, 255, 255, 0.9); border-radius: 50%; padding: 8px; cursor: pointer; z-index: 10; font-size: 18px; }

        /* --- Pagination Controls --- */
        .pagination-controls { text-align: center; margin: 40px 0; }
        .pagination-controls button {
            background-color: white; color: var(--primary-color); border: 1px solid var(--border-color);
            padding: 10px 15px; margin: 0 5px; cursor: pointer; font-size: 14px; border-radius: 4px;
            transition: all 0.3s;
        }
        .pagination-controls button:hover:not(.active) { background-color: var(--bg-color); }
        .pagination-controls button.active { background-color: var(--accent-color); color: white; border-color: var(--accent-color); }
        .pagination-controls button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* --- Infinite Scrolling Indicator --- */
        #infinite-scroll-indicator { text-align: center; padding: 20px; font-size: 16px; color: #777; }

        /* --- Product Detail View (Fullscreen) --- */
        .detail-view { padding: 0; background-color: var(--card-bg); }
        .detail-main-content { display: flex; padding: 30px 20px; gap: 30px; }
        .detail-images { flex: 1; max-width: 50%; }
        .detail-info { flex: 1; max-width: 50%; }
        /* Fixed Order Button */
        .fixed-order-btn {
            position: fixed; bottom: 0; left: 0; right: 0; 
            padding: 15px; background-color: var(--card-bg); 
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1); 
            text-align: center; z-index: 1000;
        }
        .order-btn-large {
            display: block; max-width: 800px; margin: 0 auto;
            padding: 15px 30px; background-color: var(--accent-color);
            color: white; border-radius: 6px; font-size: 20px;
            font-weight: bold; transition: background-color 0.3s;
        }

        /* ======================================= */
        /* === MOBILE OPTIMIZATION === */
        /* ======================================= */
        @media (max-width: 768px) {
            .main-header { padding: 10px 15px; }
            .social-icons { display: none; }
            .admin-btn { margin-left: 10px; padding: 6px 10px; font-size: 12px; }
            .slider-container { height: 250px; }
            .slider-caption { font-size: 18px; padding: 8px 15px; }
            .category-item { flex: 0 0 80px; }
            .cat-icon { width: 80px; height: 80px; }
            
            /* Card Layout */
            .cards-container { gap: 15px; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); }
            .card-image-slider { height: 200px; }

            /* Pagination Compact */
            .pagination-controls button { padding: 8px 10px; margin: 0 3px; font-size: 12px; }
            
            /* Detail View Mobile Layout */
            .detail-main-content { flex-direction: column; padding: 15px; }
            .detail-images, .detail-info { max-width: 100%; flex: none; }
            .order-btn-large { font-size: 16px; padding: 12px 20px; }
        }
    </style>
</head>
<body>

    <main id="app-container">
        
        <header class="main-header">
            <div class="header-left">
                <span class="cart-icon" onclick="alert('Shopping cart feature coming soon!')">ðŸ›’</span> 
                <div class="logo"><a href="index.html">StyleGrid</a></div>
                <button class="admin-btn" onclick="promptAdminLogin()">Admin Panel</button>
            </div>
            
            <div class="social-icons">
                <a href="https://www.instagram.com/stylegrid" target="_blank" title="Instagram">ðŸ“·</a>
                <a href="https://www.pinterest.com/stylegrid" target="_blank" title="Pinterest">ðŸ“Œ</a>
                <a href="https://www.tiktok.com/@stylegrid" target="_blank" title="TikTok">ðŸŽµ</a>
                <a href="https://www.facebook.com/stylegrid" target="_blank" title="Facebook">ðŸ“˜</a>
            </div>
        </header>
        
        <div id="home-view" class="view">
            
            <section id="trending-slider" class="slider-section">
                <div id="slider-inner" class="slider-container">
                    <div class="slider-caption">Loading Latest Trends...</div>
                </div>
            </section>
            
            <div class="container">
                <section id="category-grid" class="category-grid">
                    <h2>Shop By Category</h2>
                    <div class="categories-container" id="categories-container">
                        <p style="text-align: center;">Loading categories...</p>
                    </div>
                </section>
            </div>
        </div>

        <div id="category-view" class="view hidden">
            <div class="container">
                <div class="category-header-title">
                    <div id="cat-icon-display" class="cat-icon" style="margin: 0 auto 10px;"></div>
                    <h2 id="category-view-title"></h2>
                </div>
                
                <div id="cards-container" class="cards-container">
                    </div>

                <div id="pagination-controls" class="pagination-controls hidden">
                    </div>
                
                <div id="infinite-scroll-indicator" class="hidden">Loading more products...</div>
            </div>
        </div>

        <div id="detail-view" class="view detail-view hidden">
            <div class="detail-top-bar">
                <span class="back-btn" onclick="window.history.back()">&#x25C0;</span>
                <h3 id="detail-header-title">Product Details</h3>
            </div>
            
            <div id="detail-content">
                </div>
            
            <div class="fixed-order-btn">
                <a href="#" id="detail-order-btn" target="_blank" class="order-btn-large" rel="noopener noreferrer">ORDER NOW - See Price & Sizes</a>
            </div>
        </div>
        
        <footer class="main-footer">
            <p>&copy; <span id="current-year"></span> StyleGrid. All Rights Reserved.</p>
            <p><a href="#" onclick="promptAdminLogin()">Admin Login</a> | <a href="#">Privacy Policy</a></p>
        </footer>
    </main>
    
    <script>
        // --- 1. CONFIGURATION & STATE ---
        const ADMIN_PASSWORD = "SGADMIN"; // Normal Password
        const CARDS_PER_PAGE = 50; // For Pagination
        const CARDS_PER_SCROLL = 20; // For Infinite Scrolling

        let currentCategoryData = []; // Stores all cards for the currently viewed category
        let currentPage = 1;

        const CATEGORIES = {
            'male_tshirts': "Men's T-Shirts", 'male_pants': "Men's Pants", 'male_outerwear': "Men's Outerwear",
            'male_shoes': "Men's Shoes", 'male_accessories': "Men's Accessories", 'female_dresses': "Women's Dresses",
            'female_tops': "Women's Tops & Blouses", 'female_bottoms': "Women's Jeans & Leggings",
            'female_activewear': "Women's Activewear", 'female_jewelry': "Women's Jewelry & Bags"
        };
        const ALL_JSON_FILES = Object.keys(CATEGORIES).map(key => `data/${key}.json`);

        // --- 2. CORE UTILITY FUNCTIONS ---
        const fetchJson = async (fileName) => {
            try {
                const response = await fetch(fileName);
                if (!response.ok) { console.error(`File not found: ${fileName}`); return []; }
                return await response.json();
            } catch (error) {
                console.error(`Error fetching ${fileName}:`, error);
                return [];
            }
        };

        const renderStarRating = (rating) => {
            const fullStars = Math.floor(rating);
            let starsHtml = '';
            for (let i = 0; i < fullStars; i++) starsHtml += 'â˜…';
            if (rating % 1 >= 0.5) starsHtml += 'Â½'; 
            return `<span class="stars">${starsHtml}</span> (${rating})`;
        };

        const navigateTo = (viewId, state = {}) => {
            document.querySelectorAll('.view').forEach(view => view.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            window.history.pushState(state, '', `${window.location.pathname}${state.path || ''}`);
            window.scrollTo(0, 0); 
        };

        // --- 3. RENDERING CARDS (Flipkart Style Card) ---
        const createCardHTML = (card) => {
            const shareUrl = `${window.location.origin}${window.location.pathname}?view=detail&id=${card.id}`;
            const imagesHtml = card.images.map(src => 
                `<img class="card-image lazy" data-src="${src}" alt="${card.title}" loading="lazy">`
            ).join('');

            return `
                <div class="product-card" data-card-id="${card.id}" data-images-count="${card.images.length}" onclick="loadProductDetail('${card.id}')">
                    <div class="share-icon" onclick="event.stopPropagation(); shareProduct('${card.title}', '${shareUrl}')">
                        <span>ðŸ”—</span>
                    </div>
                    <div class="card-image-slider">
                        <div class="card-image-wrapper">
                            ${imagesHtml}
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="card-rating">
                            ${renderStarRating(card.rating)} | ${card.review_count || 0} Reviews
                        </div>
                        <h3 class="card-title">${card.title}</h3>
                        <a href="${card.affiliate_link}" target="_blank" class="order-btn" rel="noopener noreferrer" onclick="event.stopPropagation();">ORDER NOW</a>
                    </div>
                </div>
            `;
        };

        // Image Slider Initializer (5 Second Slide)
        const initImageSliders = (selector = '.product-card') => {
             document.querySelectorAll(selector).forEach(card => {
                const sliderWrapper = card.querySelector('.card-image-wrapper');
                const images = card.querySelectorAll('.card-image');
                let totalImages = images.length;
                let currentImage = 0;

                if (totalImages <= 1) return; 

                // Load images for the current view
                images.forEach(img => {
                    img.src = img.getAttribute('data-src');
                    img.removeAttribute('data-src');
                });

                // Auto-slide logic
                setInterval(() => {
                    currentImage = (currentImage + 1) % totalImages;
                    const offset = -currentImage * 100;
                    sliderWrapper.style.transform = `translateX(${offset}%)`;
                }, 5000); 
            });
        };

        // --- 4. CATEGORY VIEW LOGIC (PAGINATION/INFINITE SCROLL) ---
        
        // Renders a specific chunk of cards (for pagination or scroll)
        const renderCardChunk = (data, append = false) => {
            const container = document.getElementById('cards-container');
            const html = data.map(createCardHTML).join('');
            if (append) {
                container.innerHTML += html;
            } else {
                container.innerHTML = html;
            }
            // Initialize sliders only on the newly added elements
            initImageSliders(); 
        };

        // Renders the Pagination controls
        const renderPaginationControls = () => {
            const totalPages = Math.ceil(currentCategoryData.length / CARDS_PER_PAGE);
            const controls = document.getElementById('pagination-controls');
            controls.innerHTML = '';

            // Previous Button
            controls.innerHTML += `<button onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Prev</button>`;

            // Page Buttons (Simplified display)
            let start = Math.max(1, currentPage - 2);
            let end = Math.min(totalPages, currentPage + 2);
            
            if (currentPage > 3) controls.innerHTML += `<button onclick="goToPage(1)">1...</button>`;

            for (let i = start; i <= end; i++) {
                controls.innerHTML += `<button onclick="goToPage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
            }
            
            if (currentPage < totalPages - 2) controls.innerHTML += `<button onclick="goToPage(${totalPages})">...${totalPages}</button>`;


            // Next Button
            controls.innerHTML += `<button onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>`;
            
            controls.classList.remove('hidden');
        };

        // Go to specific page and render cards
        window.goToPage = (page) => {
            currentPage = page;
            const startIndex = (currentPage - 1) * CARDS_PER_PAGE;
            const endIndex = startIndex + CARDS_PER_PAGE;
            const pageData = currentCategoryData.slice(startIndex, endIndex);

            renderCardChunk(pageData, false);
            renderPaginationControls();
            document.getElementById('category-view').scrollIntoView({ behavior: 'smooth' }); // Scroll back to top of products
            
            // Re-check for infinite scrolling ability (if items are less than 50)
            if (currentCategoryData.length < CARDS_PER_PAGE) {
                 setupInfiniteScrolling();
            } else {
                 // Ensure infinite scroll is disabled in pagination mode
                 window.removeEventListener('scroll', infiniteScrollHandler);
                 document.getElementById('infinite-scroll-indicator').classList.add('hidden');
            }
        };
        
        // Handles infinite scroll (for categories with < 50 items)
        let isLoading = false;
        let loadedItems = 0;
        const infiniteScrollHandler = () => {
            if (isLoading || loadedItems >= currentCategoryData.length) return;
            
            const indicator = document.getElementById('infinite-scroll-indicator');
            const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
            
            if (scrollTop + clientHeight >= scrollHeight - 300) {
                // User is near the bottom
                isLoading = true;
                indicator.classList.remove('hidden');

                const startIndex = loadedItems;
                const endIndex = Math.min(loadedItems + CARDS_PER_SCROLL, currentCategoryData.length);
                const chunk = currentCategoryData.slice(startIndex, endIndex);

                if (chunk.length > 0) {
                    renderCardChunk(chunk, true);
                    loadedItems = endIndex;
                }
                
                isLoading = false;
                if (loadedItems >= currentCategoryData.length) {
                    indicator.textContent = "You've reached the end of the category.";
                } else {
                    indicator.classList.add('hidden');
                }
            }
        };
        
        // Setup scroll event only if needed
        const setupInfiniteScrolling = () => {
             // Only activate if total items are less than the pagination threshold
             if (currentCategoryData.length <= CARDS_PER_PAGE) {
                 loadedItems = CARDS_PER_PAGE; // Start loading from the second set of items
                 window.addEventListener('scroll', infiniteScrollHandler);
                 document.getElementById('pagination-controls').classList.add('hidden');
                 document.getElementById('infinite-scroll-indicator').textContent = "Loading more products...";
             } else {
                 window.removeEventListener('scroll', infiniteScrollHandler);
                 document.getElementById('infinite-scroll-indicator').classList.add('hidden');
             }
        }
        
        // Load the full category data
        window.loadCategoryView = async (categoryKey) => {
            const jsonFileName = `data/${categoryKey}.json`;
            const categoryName = CATEGORIES[categoryKey];
            
            navigateTo('category-view', { view: 'category', key: categoryKey, path: `?view=category&key=${categoryKey}` });
            
            document.getElementById('category-view-title').textContent = categoryName;
            document.getElementById('cat-icon-display').style.backgroundImage = `url('placeholder_${categoryKey}.jpg')`;

            currentCategoryData = await fetchJson(jsonFileName);
            
            // Sort by unique ID descending to show latest first
            currentCategoryData.sort((a, b) => b.id.localeCompare(a.id)); 
            
            if (currentCategoryData.length > CARDS_PER_PAGE) {
                // Use Pagination (load only the first page)
                goToPage(1);
            } else {
                // Use Infinite Scrolling (load all at once, then handle scroll for 20 more)
                renderCardChunk(currentCategoryData.slice(0, CARDS_PER_PAGE), false);
                setupInfiniteScrolling(); 
            }
        };


        // --- 5. INITIALIZATION & ADMIN LOGIN ---
        const promptAdminLogin = () => {
            const password = prompt("Enter Admin Password:");
            if (password === ADMIN_PASSWORD) {
                window.open('admin.html', '_blank');
            } else if (password !== null) {
                alert("Incorrect Password.");
            }
        };

        const initializeHomeView = async () => {
            // (Previous logic for loading Categories and Trending Slider goes here)
            // ... (The dynamic loading of categories and trending data)

            // 6. Handle URL Routing
            // ... (Your previous SPA routing logic to check for view=category or view=detail)
        };
        
        // Handle Browser Back/Forward buttons
        window.onpopstate = (event) => {
            // ... (Previous window.onpopstate logic to handle back button)
        };

        // Final Initialization
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            initializeHomeView();
        });
        
        // Simple Share Function
        const shareProduct = (title, url) => {
            // ... (Previous share function logic)
        };
        
        // Load Product Detail (Needs to be defined globally or in the same scope)
        window.loadProductDetail = async (cardId) => {
            // ... (Previous loadProductDetail logic)
        };
    </script>
</body>
</html>
