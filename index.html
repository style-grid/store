<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Binodon - Home</title>
    <!-- FontAwesome Library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- বেসিক রিসেট --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; text-decoration: none; }
        body { background-color: #ffffff; display: flex; justify-content: center; }
        
        /* মেইন কন্টেইনার */
        .main-container {
            background-color: white; width: 100%; max-width: 600px;
            min-height: 100vh; border-left: 1px solid #ddd; border-right: 1px solid #ddd;
            position: relative;
        }

        /* --- প্রোফাইল হেডার --- */
        .cover-photo { width: 100%; height: 160px; background-color: #ddd; overflow: hidden; position: relative; }
        .cover-photo img { width: 100%; height: 100%; object-fit: cover; }

        .profile-header-area { position: relative; padding: 0 15px; display: flex; justify-content: space-between; align-items: flex-start; }
        .profile-pic-container { margin-top: -55px; z-index: 2; }
        .profile-pic { width: 110px; height: 110px; border-radius: 50%; border: 4px solid white; background-color: #000; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        .profile-pic img { width: 100%; height: 100%; object-fit: cover; }

        .action-buttons { display: flex; gap: 8px; margin-top: 10px; }
        .btn { border: none; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold; color: white; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .btn-email { background-color: #1da1f2; }
        .btn-share { background-color: #000; }

        .info-section { padding: 5px 15px 15px 15px; }
        .website-name { font-size: 22px; font-weight: 800; color: #1c1e21; text-transform: uppercase; }
        .username { font-size: 15px; color: #65676b; margin-bottom: 8px; }
        .stats { font-size: 14px; color: #050505; margin-bottom: 8px; }
        .stats b { font-weight: 800; }
        .meta-info { display: flex; gap: 15px; color: #65676b; font-size: 13px; margin-bottom: 12px; align-items: center; }
        .meta-info i { margin-right: 4px; }
        .bio { font-size: 14px; color: #1c1e21; line-height: 1.4; text-align: justify; margin-bottom: 15px; }

        /* --- নেভিগেশন বার (FIXED BUTTON COLOR) --- */
        .nav-bar {
            display: flex; gap: 10px; padding: 10px 15px;
            border-top: 1px solid #e1e8ed; border-bottom: 1px solid #e1e8ed;
            margin-bottom: 5px; background: #fff; position: sticky; top: 0; z-index: 100;
        }
        .nav-btn {
            padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold;
            cursor: pointer; border: 1px solid #e1e8ed; display: flex; align-items: center;
            gap: 6px; transition: background-color 0.1s ease;
        }
        
        /* Active Class - !important ব্যবহার করা হয়েছে যাতে কালার ফিক্স থাকে */
        .nav-btn.active { 
            background-color: #000 !important; 
            color: white !important; 
            border: 1px solid #000 !important; 
        }
        .nav-btn.inactive { background-color: #f0f2f5; color: #000; }
        .nav-btn:hover { background-color: #e4e6eb; }

        /* --- পোস্ট কার্ড ডিজাইন --- */
        #feed-container { min-height: 200px; }
        #loading-msg { text-align: center; padding: 20px; color: #666; }

        .post-card { padding: 15px; border-bottom: 1px solid #e1e8ed; display: flex; flex-direction: column; gap: 10px; }
        .post-header { display: flex; gap: 10px; align-items: center; }
        .post-pfp { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; background-color: #ddd; }
        .post-pfp img { width: 100%; height: 100%; object-fit: cover; }
        
        .post-meta-text { display: flex; flex-direction: column; justify-content: center; }
        .name-row { display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
        .name-row h3 { font-size: 16px; font-weight: 800; color: #0f1419; margin: 0; }
        .post-username { font-size: 15px; color: #536471; }
        .time-ago { font-size: 15px; color: #536471; }
        .dot-separator { font-size: 15px; color: #536471; margin: 0 2px; }

        .clickable-area { cursor: pointer; }
        .post-title { font-size: 17px; font-weight: 700; color: #0f1419; margin-bottom: 5px; line-height: 1.3; }
        .post-excerpt { font-size: 15px; color: #0f1419; line-height: 1.4; margin-bottom: 8px; }
        .read-more-text { color: #1da1f2; font-weight: 600; font-size: 14px; }
        .hashtags { color: #1d9bf0; font-size: 15px; margin-bottom: 10px; cursor: default; }

        .media-container {
            position: relative; width: 100%; border-radius: 12px; overflow: hidden;
            margin-top: 5px; display: block; max-height: 720px; cursor: pointer; background: #000;
        }
        .media-container img { width: 100%; height: auto; display: block; object-fit: contain; margin: 0 auto; max-height: 720px; }
        .play-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60px; height: 60px; background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            pointer-events: none; border: 2px solid rgba(255,255,255,0.8);
        }
        .play-icon::after {
            content: ''; display: block; width: 0; height: 0;
            border-left: 18px solid white; border-top: 11px solid transparent;
            border-bottom: 11px solid transparent; margin-left: 4px;
        }

        .post-footer {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 12px; color: #536471; font-size: 16px; font-weight: 500;
        }
        .footer-left { display: flex; align-items: center; gap: 6px; }
        .footer-right { display: flex; align-items: center; gap: 20px; }

        .love-btn { cursor: pointer; display: flex; align-items: center; gap: 5px; transition: all 0.2s; user-select: none; }
        .love-btn:hover { color: #e0245e; background-color: rgba(224, 36, 94, 0.1); padding: 4px 8px; border-radius: 15px; margin: -4px -8px; }
        .love-btn.liked { color: #e0245e; } .love-btn.liked i { font-weight: 900; }
        
        .count-text { font-weight: bold; }
        .label-text { font-weight: normal; font-size: 15px; }
        .post-date-display { font-size: 14px; color: #65676b; }

        .footer-share-btn {
            cursor: pointer; padding: 8px; border-radius: 50%; transition: all 0.2s ease;
            display: flex; align-items: center; justify-content: center;
        }
        .footer-share-btn:hover { background-color: rgba(0,0,0,0.05); }

        .spinner {
            width: 14px; height: 14px; border: 2px solid #ccc;
            border-top: 2px solid #000; border-radius: 50%;
            animation: spin 1s linear infinite; display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* লগইন পেজ */
        #login-view { display: none; padding: 40px 20px; text-align: center; }
        .login-box { background: white; padding: 30px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto; }
        .login-logo { width: 60px; height: 60px; margin-bottom: 20px; border-radius: 50%; }
        .login-submit-btn { width: 100%; padding: 12px; background-color: #000; color: white; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .success-msg { color: green; font-weight: bold; margin-top: 15px; display: none; }

        .notification {
            position: fixed; top: 70px; left: 50%; transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.85); color: white; padding: 10px 20px;
            border-radius: 30px; z-index: 1002; opacity: 0; transition: opacity 0.3s;
            font-size: 14px; pointer-events: none;
        }
        .notification.show { opacity: 1; }

    </style>
</head>
<body>

    <div class="main-container">
        <!-- প্রোফাইল সেকশন -->
        <div class="cover-photo">
            <img src="https://images.unsplash.com/photo-1531256379416-9f000e705ffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" alt="Cover">
        </div>

        <div class="profile-header-area">
            <div class="profile-pic-container">
                <div class="profile-pic">
                    <img src="https://images.unsplash.com/photo-1614680376593-902f74cf0d41?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80" alt="Logo">
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-email"><i class="fa-solid fa-envelope"></i> Send Email</button>
                <button class="btn btn-share"><i class="fa-solid fa-share-nodes"></i> Share</button>
            </div>
        </div>

        <div class="info-section">
            <h1 class="website-name">SECRET BINODON</h1>
            <p class="username">@SecretBinodon</p>

            <div class="stats">
                <!-- রিয়েল ভিডিও সংখ্যা এবং ফায়ারবেস থেকে মোট ভিউ -->
                <span>Total Videos <b id="total-videos-count"><span class="spinner"></span></b></span> • 
                <span>Total Views <b id="total-views-count"><span class="spinner"></span></b></span>
            </div>

            <div class="meta-info">
                <span><i class="fa-solid fa-location-dot"></i> United States</span>
                <span><i class="fa-regular fa-calendar"></i> Joined 08/03/2023</span>
            </div>

            <p class="bio">
                Secret Binodon is one of the most popular websites for Viral Videos. Which can be very helpful for your daily entertainment.
            </p>
        </div>

        <!-- নেভিগেশন (কালার ফিক্স করা হয়েছে) -->
        <div class="nav-bar">
            <div class="nav-btn active" id="nav-home" onclick="showFeed()"><i class="fa-solid fa-house"></i> Home</div>
            <div class="nav-btn inactive" id="nav-signup" onclick="goToSignUp()"><i class="fa-solid fa-user-plus"></i> Sign Up</div>
            <div class="nav-btn inactive" id="nav-login" onclick="showLogin()"><i class="fa-solid fa-arrow-right-to-bracket"></i> Login</div>
        </div>

        <!-- ফিড এরিয়া -->
        <div id="feed-container">
            <div id="loading-msg">Loading latest posts...</div>
        </div>

        <!-- লগইন পেজ -->
        <div id="login-view">
            <div class="login-box">
                <img src="https://images.unsplash.com/photo-1614680376593-902f74cf0d41?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80" alt="Logo" class="login-logo">
                <h2 class="login-title">Log in to Secret Binodon</h2>
                <form id="loginForm">
                    <div style="text-align:left; margin-bottom:15px;"><label>Email</label><input type="text" placeholder="Enter email" required style="width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:5px;"></div>
                    <div style="text-align:left; margin-bottom:15px;"><label>Password</label><input type="password" placeholder="Enter password" required style="width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:5px;"></div>
                    <button type="submit" class="login-submit-btn" id="loginBtn">Log in</button>
                    <div class="success-msg" id="successMsg"><i class="fa-solid fa-check-circle"></i> Login Successful!</div>
                </form>
            </div>
        </div>
        
        <div id="notification" class="notification"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, increment, onSnapshot, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyCAsD8wucLsudzY5oNbiixLGyjN2apdV0Q",
            authDomain: "my-ad-analytics-4560a.firebaseapp.com",
            databaseURL: "https://my-ad-analytics-4560a-default-rtdb.firebaseio.com",
            projectId: "my-ad-analytics-4560a",
            storageBucket: "my-ad-analytics-4560a.firebasestorage.app",
            messagingSenderId: "104213283950",
            appId: "1:104213283950:web:b5a25ecd54df809625127f",
            measurementId: "G-WS7QSQ9H0Y"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // হেল্পারস
        function getDeviceId() {
            let id = localStorage.getItem('deviceId');
            if (!id) { id = 'device-' + Date.now(); localStorage.setItem('deviceId', id); }
            return id;
        }
        const deviceId = getDeviceId();

        function formatCount(num) {
            if (!num) return 0;
            return num >= 1000000 ? (num/1000000).toFixed(1)+'M' : num >= 1000 ? (num/1000).toFixed(1)+'K' : num;
        }

        function timeAgo(dateString) {
            const seconds = Math.floor((new Date() - new Date(dateString)) / 1000);
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + "y ago";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + "d ago";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + "h ago";
            return "Just now";
        }
        
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        const notif = document.getElementById('notification');
        function showNotification(msg) {
            notif.textContent = msg; notif.classList.add('show');
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        // মেইন ডাটা লোড ফাংশন
        async function loadFeed() {
            try {
                const res = await fetch('posts.json');
                const posts = await res.json();
                
                // ১. টোটাল ভিডিও সংখ্যা আপডেট (JSON ফাইল অনুযায়ী)
                document.getElementById('total-videos-count').innerText = formatCount(posts.length);
                
                // ২. টোটাল ভিউ আপডেট (ফায়ারবেস থেকে সব যোগ করে)
                calculateTotalViews();

                const container = document.getElementById('feed-container');
                container.innerHTML = '';

                posts.forEach(post => {
                    let excerpt = "No description available.";
                    if (post.paragraphs && post.paragraphs.length > 0) {
                        excerpt = post.paragraphs[0].substring(0, 120) + "...";
                    }

                    // Share Button এ Title পাস করা হচ্ছে
                    const html = `
                        <div class="post-card" data-id="${post.id}">
                            <div class="post-header">
                                <div class="post-pfp"><img src="${post.profileImage}"></div>
                                <div class="post-meta-text">
                                    <div class="name-row">
                                        <h3>Secret Binodon</h3> 
                                        <span class="post-username">@SecretBinodon</span> 
                                        <span class="dot-separator">·</span> 
                                        <span class="time-ago">${timeAgo(post.uploadTime)}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="clickable-area" onclick="openPost('${post.id}')">
                                <div class="post-title">${post.title}</div>
                                <div class="post-excerpt">${excerpt} <span class="read-more-text">See more</span></div>
                            </div>
                            
                            <div class="hashtags">${post.hashtags}</div>
                            
                            <div class="clickable-area" onclick="openPost('${post.id}')">
                                <div class="media-container">
                                    <img src="${post.mediaImage}">
                                    <div class="play-icon"></div>
                                </div>
                            </div>

                            <div class="post-footer">
                                <div class="footer-left">
                                    <i class="fa-solid fa-chart-simple"></i> 
                                    <span class="count-text view-count"><span class="spinner"></span></span> 
                                    <span class="label-text">Views</span>
                                </div>
                                <div class="footer-right">
                                    <div class="love-btn">
                                        <i class="fa-regular fa-heart"></i>
                                        <span class="count-text like-count"><span class="spinner"></span></span>
                                        <span class="label-text">Likes</span>
                                    </div>
                                    <div class="post-date-display">${formatDate(post.uploadTime)}</div>
                                    <!-- শেয়ার বাটনে টাইটেল আর্গুমেন্ট পাঠানো হচ্ছে -->
                                    <div class="footer-share-btn" onclick="sharePost('${post.id}', '${post.title.replace(/'/g, "\\'")}')">
                                        <i class="fa-solid fa-share-from-square"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', html);
                });

                initializeFirebase();

            } catch (e) {
                console.error(e);
                document.getElementById('loading-msg').innerText = "Failed to load posts.";
            }
        }

        // ফায়ারবেস লিসেনার (লাইক ও ভিউ)
        function initializeFirebase() {
            document.querySelectorAll('.post-card').forEach(card => {
                const id = card.getAttribute('data-id');
                const viewEl = card.querySelector('.view-count');
                const likeEl = card.querySelector('.like-count');
                const loveBtn = card.querySelector('.love-btn');

                // ভিউ
                onSnapshot(doc(db, "views", id), (s) => {
                    viewEl.innerText = formatCount(s.data()?.count || 0);
                });

                // লাইক
                const loveRef = doc(db, "loves", id);
                const userRef = doc(db, `loves/${id}/users`, deviceId);

                getDoc(userRef).then(s => {
                    if(s.exists()) {
                        loveBtn.classList.add('liked');
                        loveBtn.querySelector('i').classList.replace('fa-regular', 'fa-solid');
                    }
                });

                onSnapshot(loveRef, (s) => likeEl.innerText = formatCount(s.data()?.count || 0));

                loveBtn.addEventListener('click', async () => {
                    const s = await getDoc(userRef);
                    if(s.exists()) {
