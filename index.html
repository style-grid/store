<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Binodon</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-decoration: none; }
        body { background-color: #ffffff; display: flex; justify-content: center; }
        
        /* ‡¶Æ‡ßá‡¶á‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
        .main-container {
            background-color: white; width: 100%; max-width: 600px;
            min-height: 100vh; border-left: 1px solid #ddd; border-right: 1px solid #ddd;
            position: relative; padding-bottom: 0;
        }

        /* --- ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        /* --- ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶π‡ßá‡¶°‡¶æ‡¶∞ --- */
        .cover-photo { width: 100%; height: 160px; background-color: #ddd; overflow: hidden; position: relative; }
        .cover-photo img { width: 100%; height: 100%; object-fit: cover; }

        .profile-header-area { position: relative; padding: 0 15px; display: flex; justify-content: space-between; align-items: flex-start; }
        .profile-pic-container { margin-top: -75px; z-index: 2; }
        .profile-pic { width: 140px; height: 140px; border-radius: 50%; border: 4px solid white; background-color: #000; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        .profile-pic img { width: 100%; height: 100%; object-fit: cover; }

        .action-buttons { display: flex; gap: 8px; margin-top: 10px; }
        .btn { border: none; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold; color: white; cursor: pointer; display: flex; align-items: center; gap: 5px; transition: transform 0.1s; }
        .btn:active { transform: scale(0.95); }
        .btn-email { background-color: #1da1f2; }
        .btn-share { background-color: #000; }

        .info-section { padding: 5px 15px 15px 15px; }
        .website-name { font-size: 22px; font-weight: 800; color: #1c1e21; text-transform: uppercase; }
        .username { font-size: 15px; color: #65676b; margin-bottom: 8px; }
        .stats { font-size: 14px; color: #050505; margin-bottom: 8px; }
        .stats b { font-weight: 800; }
        .meta-info { display: flex; gap: 15px; color: #65676b; font-size: 13px; margin-bottom: 12px; align-items: center; }
        .meta-info i { margin-right: 4px; }
        .bio { font-size: 14px; color: #1c1e21; line-height: 1.4; text-align: justify; margin-bottom: 15px; }

        /* --- ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞ --- */
        .nav-bar {
            display: flex; gap: 10px; padding: 10px 15px;
            border-top: 1px solid #e1e8ed; border-bottom: 1px solid #e1e8ed;
            margin-bottom: 5px; background: #fff; position: sticky; top: 0; z-index: 100;
        }
        .nav-btn {
            padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold;
            cursor: pointer; border: 1px solid #e1e8ed; display: flex; align-items: center;
            gap: 6px; transition: background-color 0.1s ease;
        }
        .nav-btn.active { background-color: #000 !important; color: white !important; border: 1px solid #000 !important; }
        .nav-btn.inactive { background-color: #f0f2f5; color: #000; }
        .nav-btn:hover { background-color: #e4e6eb; }
        
        /* --- ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® (‡¶π‡ßã‡¶Æ ‡¶ì ‡¶∞‡¶ø‡¶≤‡ßá‡¶ü‡ßá‡¶°) --- */
        #feed-container, #related-posts-container { min-height: 200px; }
        
        .post-card { 
            padding: 15px; border-bottom: 1px solid #e1e8ed; 
            display: flex; flex-direction: column; 
            gap: 6px; 
            background: white; opacity: 0; animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn { to { opacity: 1; } }

        .post-header { display: flex; gap: 10px; align-items: center; }
        .post-pfp { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; background-color: #ddd; }
        .post-pfp img { width: 100%; height: 100%; object-fit: cover; }
        .post-meta-text { display: flex; flex-direction: column; justify-content: center; }
        .name-row { display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
        .name-row h3 { font-size: 18px; font-weight: 800; color: #0f1419; margin: 0; }
        .post-username { font-size: 14px; color: #536471; }
        .time-ago { font-size: 15px; color: #536471; }
        .dot-separator { font-size: 15px; color: #536471; margin: 0 2px; }
        .clickable-area { cursor: pointer; }
        .post-title { 
            font-size: 18px; 
            font-weight: 700; 
            color: #0f1419; 
            margin-bottom: 8px; 
            margin-top: -3px; 
            line-height: 1.3; 
        }
        .post-excerpt { 
            font-size: 15px; color: #0f1419; line-height: 1.4; margin-bottom: 8px;
            display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;
        }
        .read-more-text { color: #1da1f2; font-weight: 600; font-size: 14px; }
        .hashtags { color: #1d9bf0; font-size: 15px; margin-bottom: 10px; cursor: default; }
        .media-container {
            position: relative; width: 100%; border-radius: 12px; overflow: hidden;
            margin-top: 5px; display: block; max-height: 720px; cursor: pointer; background: #000;
        }
        .media-container img { width: 100%; height: auto; display: block; object-fit: contain; margin: 0 auto; max-height: 720px; }
        .play-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60px; height: 60px; background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            pointer-events: none; border: 2px solid rgba(255,255,255,0.8);
        }
        .play-icon::after {
            content: ''; display: block; width: 0; height: 0;
            border-left: 18px solid white; border-top: 11px solid transparent;
            border-bottom: 11px solid transparent; margin-left: 4px;
        }
        .duration-badge {
            position: absolute; bottom: 8px; right: 8px;
            background-color: rgba(0, 0, 0, 0.8); color: white;
            padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold;
            pointer-events: none; z-index: 5;
        }
        .post-footer {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 12px; color: #536471; font-size: 16px; font-weight: 500;
        }
        .footer-left { display: flex; align-items: center; gap: 6px; }
        .footer-right { display: flex; align-items: center; gap: 20px; }
        .love-btn, .love-btn-rel { cursor: pointer; display: flex; align-items: center; gap: 5px; transition: all 0.2s; user-select: none; }
        .love-btn:hover, .love-btn-rel:hover { color: #e0245e; background-color: rgba(224, 36, 94, 0.1); padding: 4px 8px; border-radius: 15px; margin: -4px -8px; }
        .love-btn.liked, .love-btn-rel.liked { color: #e0245e; } .love-btn.liked i, .love-btn-rel.liked i { font-weight: 900; }
        .count-text { font-weight: bold; }
        .label-text { font-weight: normal; font-size: 15px; }
        .post-date-display { font-size: 14px; color: #65676b; }
        .footer-share-btn {
            cursor: pointer; padding: 8px; border-radius: 50%; transition: all 0.2s ease;
            display: flex; align-items: center; justify-content: center;
        }
        .footer-share-btn:hover { background-color: rgba(0,0,0,0.05); }

        /* --- ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶á‡¶®‡¶´‡¶ø‡¶®‡¶ø‡¶ü‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ (Wave Loader) --- */
        .wave-loader {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            gap: 5px; 
        }
        .wave-loader div {
            width: 10px;
            height: 10px;
            background-color: #1da1f2; 
            border-radius: 50%;
            animation: bounce 1.2s infinite ease-in-out both;
            transform: scale(0);
        }
        .wave-loader div:nth-child(1) { animation-delay: -0.32s; }
        .wave-loader div:nth-child(2) { animation-delay: -0.16s; }
        .wave-loader div:nth-child(3) { animation-delay: 0s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); } 
            40% { transform: scale(1.0); } 
        }

        /* Infinite Scroll Loader (Sentinel) */
        #home-sentinel, #related-sentinel { width: 100%; height: 50px; display: flex; align-items: center; justify-content: center; }
        #home-sentinel .wave-loader { display: none; } 
        #home-sentinel.loading .wave-loader { display: flex; } 

        /* --- ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶≤‡¶ó‡¶á‡¶® ‡¶≠‡¶ø‡¶â --- */
        .site-footer { background-color: #fff; padding: 30px 20px; text-align: center; border-top: none; margin-top: 0; }
        .footer-links { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 15px; }
        .footer-links a { color: #536471; font-size: 14px; font-weight: 500; transition: color 0.2s; }
        .footer-links a:hover { color: #1da1f2; text-decoration: underline; }
        .footer-copyright { color: #536471; font-size: 13px; }
        .footer-copyright a { color: #1da1f2; font-weight: bold; }

        /* --- ‡¶≤‡¶ó‡¶á‡¶® ‡¶≠‡¶ø‡¶â --- */
        #login-view { display: none; padding: 40px 20px; text-align: center; }
        .login-box { background: white; padding: 30px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto; }
        .login-title { margin-bottom: 20px; }
        .login-submit-btn { width: 100%; padding: 12px; background-color: #000; color: white; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .success-msg { color: green; font-weight: bold; margin-top: 15px; display: none; }
        .notification {
            position: fixed; top: 70px; left: 50%; transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.85); color: white; padding: 10px 20px;
            border-radius: 30px; z-index: 1002; opacity: 0; transition: opacity 0.3s;
            font-size: 14px; pointer-events: none;
        }
        .notification.show { opacity: 1; }
        
        /* --- ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶≠‡¶ø‡¶â ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        #post-view { display: none; }
        header { background: #1da1f2; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; color: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .logo-area { font-weight: 800; font-size: 20px; text-transform: uppercase; cursor: pointer; }
        .header-btn { background: white; color: #1da1f2; padding: 6px 15px; border-radius: 20px; font-weight: bold; font-size: 14px; margin-left: 10px; cursor: pointer; }
        .post-author-area { padding: 10px 15px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #e1e8ed; }
        .author-info { display: flex; align-items: center; gap: 10px; }
        .pfp { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; background: #ddd; }
        .pfp img { width: 100%; height: 100%; object-fit: cover; }
        .author-text h3 { font-size: 16px; margin: 0; color: #0f1419; }
        .author-text span { font-size: 14px; color: #536471; }
        .post-time { font-size: 13px; color: #536471; font-weight: bold; }
        .video-container { width: 100%; aspect-ratio: 16/9; background: #000; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-top: 5px; cursor: pointer; }
        .video-container img { width: 100%; height: 100%; object-fit: contain; }
        .play-btn-center { position: absolute; width: 60px; height: 60px; background: rgba(0,0,0,0.6); border-radius: 50%; border: 3px solid #fff; display: flex; align-items: center; justify-content: center; z-index: 5; pointer-events: none; }
        .play-btn-center::after { content: ''; border-left: 20px solid white; border-top: 12px solid transparent; border-bottom: 12px solid transparent; margin-left: 5px; }
        .main-video-spinner { display: none; position: absolute; width: 50px; height: 50px; border: 5px solid rgba(255, 255, 255, 0.3); border-top: 5px solid #fff; border-radius: 50%; animation: spin 1s linear infinite; z-index: 6; }
        .video-controls { position: absolute; bottom: 0; left: 0; width: 100%; padding: 10px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; display: flex; justify-content: space-between; font-size: 12px; z-index: 5; }
        .content-body { padding: 15px 15px 0 15px; }
        .article-title { font-size: 20px; font-weight: 800; margin-bottom: 15px; color: #0f1419; line-height: 1.3; }
        .article-para { font-size: 15px; line-height: 1.4; color: #1c1e21; margin-bottom: 12px; text-align: left; letter-spacing: -0.3px; }
        .download-btn { display: block; width: fit-content; margin: 20px auto; padding: 10px 20px; border-radius: 5px; font-weight: bold; font-size: 14px; text-align: center; color: white; cursor: pointer; text-transform: uppercase; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .download-btn:active { transform: scale(0.98); }
        .stats-section { padding: 12px 0; margin-top: 15px; border-top: 1px solid #e1e8ed; border-bottom: 1px solid #e1e8ed; display: flex; align-items: center; background: #fff; }
        .stats-left { display: flex; align-items: center; gap: 20px; flex-grow: 1; overflow: hidden; }
        .view-stat { flex: 0 0 auto; display: flex; align-items: center; gap: 5px; font-weight: bold; font-size: 15px; color: #536471; }
        .view-stat i { font-size: 16px; }
        .like-stat-container { flex: 1 1 auto; display: flex; justify-content: center; }
        .share-icons { flex: 0 0 auto; display: flex; gap: 8px; }
        .share-icon { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; font-size: 13px; transition: 0.2s; }
        .share-icon:hover { opacity: 0.8; transform: scale(1.1); }
        .related-section { background: #fff; margin-top: 0; }
        .related-header { padding: 15px; font-weight: 800; color: #536471; border-bottom: 1px solid #e1e8ed; text-transform: uppercase; background: #fff; }
        .spinner { width: 14px; height: 14px; border: 2px solid #ccc; border-top: 2px solid #000; border-radius: 50%; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #related-sentinel .load-more-spinner { width: 24px; height: 24px; border: 3px solid #ccc; border-top: 3px solid #1da1f2; border-radius: 50%; animation: spin 1s linear infinite; display: none; }
        #related-sentinel.loading .load-more-spinner { display: block; }

    </style>
</head>
<body>

    <div class="main-container">
        
        <div id="home-view">
            <div class="cover-photo">
                <img src="https://e0.pxfuel.com/wallpapers/114/575/desktop-wallpaper-stephanie-potrait-eyes-girls-eyes-eyes-gorgeous-eyes-arabic-eyes.jpg">
            </div>

            <div class="profile-header-area">
                <div class="profile-pic-container">
                    <div class="profile-pic">
                        <img src="https://raw.githubusercontent.com/style-grid/store/refs/heads/main/data/20251211_024630.jpg">
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-email" onclick="sendEmail()">
                        <i class="fa-solid fa-envelope"></i> Send Email
                    </button>
                    <button class="btn btn-share" onclick="shareProfile()">
                        <i class="fa-solid fa-share-nodes"></i> Share
                    </button>
                </div>
            </div>

            <div class="info-section">
                <h1 class="website-name">SECRET BINODON</h1>
                <p class="username">@SecretBinodon</p>

                <div class="stats">
                    <span>Total Videos <b id="total-videos-count">0</b></span> ‚Ä¢ 
                    <span>Total Views <b id="total-views-count">0</b></span>
                </div>

                <div class="meta-info">
                    <span><i class="fa-solid fa-location-dot"></i>üá∫üá≤ United States</span>
                    <span><i class="fa-regular fa-calendar"></i>Joined 08/03/2023</span>
                </div>

                <p class="bio">
                    Secret Binodon this is one of the most popular and best websites for Secret Binodon Viral Video, YouTube Viral Video, Facebook Viral Video, Instagram Viral Video, TikTok Viral Video and much more. Which can be very helpful for your daily life.
                </p>
            </div>

            <div class="nav-bar">
                <div class="nav-btn active" id="nav-home" onclick="showView('home')"><i class="fa-solid fa-house"></i> Home</div>
                <div class="nav-btn inactive" id="nav-signup" onclick="goToSignUp()"><i class="fa-solid fa-user-plus"></i> Sign Up</div>
                <div class="nav-btn inactive" id="nav-login" onclick="showView('login')"><i class="fa-solid fa-arrow-right-to-bracket"></i> Login</div>
            </div>
            
            <div id="feed-container"></div>
            
            <div id="home-sentinel">
                <div class="wave-loader"><div></div><div></div><div></div></div>
            </div>

        </div>

        <div id="post-view">
            <header>
                <div class="logo-area" onclick="showView('home')">SECRET BINODON</div>
                <div>
                    <span class="header-btn" onclick="goToSignUp()">Sign Up</span>
                    <span class="header-btn" onclick="showView('home')">Home</span>
                </div>
            </header>

            <div id="post-details-container">
                <div style="padding:40px; text-align:center; color:#666;">
                    <span class="spinner" style="width:24px; height:24px;"></span> Loading post...
                </div>
            </div>

            <div class="related-section">
                <div class="related-header">RELATED POSTS</div>
                <div id="related-posts-container"></div>
                <div id="related-sentinel"><div class="load-more-spinner"></div></div>
            </div>
        </div>

        <div id="login-view">
            <div class="login-box">
                <h2 class="login-title">Log in to Secret Binodon</h2>
                <form id="loginForm">
                    <div style="text-align:left; margin-bottom:15px;"><label>Email</label><input type="text" placeholder="Enter email" required style="width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:5px;"></div>
                    <div style="text-align:left; margin-bottom:15px;"><label>Password</label><input type="password" placeholder="Enter password" required style="width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:5px;"></div>
                    <button type="submit" class="login-submit-btn" id="loginBtn">Log in</button>
                    <div class="success-msg" id="successMsg"><i class="fa-solid fa-check-circle"></i> Login Successful!</div>
                </form>
            </div>
        </div>


        <footer class="site-footer" id="main-footer">
            <div class="footer-links">
                <a href="#" id="link-about">About</a>
                <a href="#" id="link-contact">Contact</a>
                <a href="#" id="link-privacy">Privacy Policy</a>
                <a href="#" id="link-terms">Terms of Service</a>
            </div>
            <div class="footer-copyright">
                Copyright ¬© 2025 <a href="index.html">SecretBinodon.com</a>. All rights reserved.
            </div>
        </footer>
        
        <div id="notification" class="notification"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, increment, onSnapshot, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        // ============================================
        //  ‡ßß. ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤
        // ============================================
        const PERMANENT_PROFILE_IMAGE_URL = "https://raw.githubusercontent.com/style-grid/store/refs/heads/main/data/20251211_024630.jpg";
        const firebaseConfig = { apiKey: "AIzaSyCAsD8wucLsudzY5oNbiixLGyjN2apdV0Q", authDomain: "my-ad-analytics-4560a.firebaseapp.com", databaseURL: "https://my-ad-analytics-4560a-default-rtdb.firebaseio.com", projectId: "my-ad-analytics-4560a", storageBucket: "my-ad-analytics-4560a.firebasestorage.app", messagingSenderId: "104213283950", appId: "1:104213283950:web:b5a25ecd54df809625127f", measurementId: "G-WS7QSQ9H0Y" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const deviceId = localStorage.getItem('deviceId') || 'device-' + Date.now();
        localStorage.setItem('deviceId', deviceId);

        // --- ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤ ---
        const CONFIG = {
            HOME_INITIAL_LOAD: 5,   
            HOME_BATCH_SIZE: 5,     
            RELATED_INITIAL_LOAD: 10,
            RELATED_BATCH_SIZE: 10, 
            GLOBAL_VIDEO_LINK: "https://www.google.com",
            CONTACT_EMAIL: "contact@secretbinodon.com", 
            footer: { about: "#", contact: "#", privacy: "#", terms: "#" }
        };

        // --- ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤ ---
        let allPosts = [];
        let homeCurrentIndex = 0;
        let homeObserver;
        
        // --- ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶™‡ßá‡¶ú ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤ ---
        let allRelatedPosts = [];
        let relatedCurrentChunkIndex = 0;
        let postsByTimeChunk = {};
        let remainingInChunk = [];
        let anchorPostTime;
        let relatedObserver;
        let currentPostId = null;

        // ============================================
        //  ‡ß®. ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶∏
        // ============================================
        function getRandomColor() { const c=['#e0245e','#17bf63','#1da1f2','#ffad1f','#794bc4']; return c[Math.floor(Math.random()*c.length)]; }
        function formatCount(num) { if (!num) return 0; return num >= 1000000 ? (num/1000000).toFixed(1)+'M' : num >= 1000 ? (num/1000).toFixed(1)+'K' : num; }
        function timeAgo(dateString) {
            const s = Math.floor((new Date() - new Date(dateString)) / 1000);
            let i = s / 31536000; if (i > 1) return Math.floor(i) + "y ago";
            i = s / 86400; if (i > 1) return Math.floor(i) + "d ago";
            i = s / 3600; if (i > 1) return Math.floor(i) + "h ago";
            return "Just now";
        }
        function formatDate(d) { return new Date(d).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }); }
        function showNotification(msg) { const n = document.getElementById('notification'); n.textContent = msg; n.classList.add('show'); setTimeout(() => n.classList.remove('show'), 3000); }
        window.sendEmail = function() { window.location.href = `mailto:${CONFIG.CONTACT_EMAIL}`; }
        window.shareProfile = function() {
            const url = window.location.origin; 
            const title = "Secret Binodon";
            const text = "Secret Binodon - The #1 Platform for Viral Videos! üé• Watch the latest trending videos all in one place. Visit now!";
            if (navigator.share) { navigator.share({ title: title, text: text, url: url }).catch((error) => console.log('Share failed', error)); } 
            else { navigator.clipboard.writeText(`${text} ${url}`); showNotification("Website link copied! üìã"); }
        }
        window.sharePost = function(id, title) {
            const url = window.location.origin + `/?view=post&id=${id}`;
            if (navigator.share) { navigator.share({ title: title, text: title, url: url }).catch((e) => console.log('Share failed', e)); }
            else { navigator.clipboard.writeText(url); showNotification("Link copied! üìã"); }
        }
        window.goToSignUp = () => window.location.href="https://www.example.com/signup";

        // ============================================
        //  ‡ß©. ‡¶≠‡¶ø‡¶â ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® (‡¶π‡ßã‡¶Æ, ‡¶™‡ßã‡¶∏‡ßç‡¶ü, ‡¶≤‡¶ó‡¶á‡¶®)
        // ============================================
        function showView(viewName, postId = null) {
            document.querySelectorAll('#home-view, #post-view, #login-view').forEach(el => el.style.display = 'none');
            document.getElementById('main-footer').style.display = 'none';
            document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('active'); b.classList.add('inactive'); });

            // Intersection Observer ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
            if (homeObserver) homeObserver.disconnect();
            if (relatedObserver) relatedObserver.disconnect();

            if (viewName === 'home') {
                document.getElementById('home-view').style.display = 'block';
                document.getElementById('main-footer').style.display = 'block';
                document.getElementById('nav-home').classList.add('active');
                document.getElementById('nav-home').classList.remove('inactive');
                // URL ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                history.pushState(null, '', window.location.origin + window.location.pathname);
                // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞
                const savedScrollPos = sessionStorage.getItem('scrollPos');
                if (savedScrollPos) window.scrollTo(0, parseInt(savedScrollPos));
                // ‡¶π‡ßã‡¶Æ ‡¶≤‡ßã‡¶°
                if(allPosts.length === 0 || document.getElementById('feed-container').children.length === 0) loadFeed(); // ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶≤‡ßã‡¶°
                setupHomeObserver(); 
            } else if (viewName === 'post' && postId) {
                document.getElementById('post-view').style.display = 'block';
                document.getElementById('main-footer').style.display = 'block';
                // URL ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                history.pushState(null, '', `/?view=post&id=${postId}`);
                currentPostId = postId;
                window.scrollTo(0, 0);
                initPostView(postId);
            } else if (viewName === 'login') {
                document.getElementById('login-view').style.display = 'block';
                document.getElementById('nav-login').classList.add('active');
                document.getElementById('nav-login').classList.remove('inactive');
                // URL ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                history.pushState(null, '', `/?view=login`);
            }
        }
        
        window.showView = showView; // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏

        // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶¨‡¶æ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï/‡¶´‡¶∞‡ßã‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶≠‡¶ø‡¶â ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        window.addEventListener('popstate', handleUrlChange);
        function handleUrlChange() {
            const params = new URLSearchParams(window.location.search);
            const view = params.get('view');
            const id = params.get('id');
            
            if (view === 'post' && id) {
                showView('post', id);
            } else if (view === 'login') {
                showView('login');
            } else {
                showView('home');
            }
        }

        // ============================================
        //  ‡ß™. ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú ‡¶≤‡¶ú‡¶ø‡¶ï
        // ============================================

        async function loadNextHomeBatch(size = CONFIG.HOME_BATCH_SIZE) {
            const container = document.getElementById('feed-container');
            const sentinel = document.getElementById('home-sentinel');

            if (homeCurrentIndex >= allPosts.length) {
                sentinel.style.display = 'none';
                return;
            }

            if (size === CONFIG.HOME_BATCH_SIZE) {
                 sentinel.classList.add('loading');
            }

            const batch = allPosts.slice(homeCurrentIndex, homeCurrentIndex + size);
            
            batch.forEach(post => {
                let excerpt = post.paragraphs && post.paragraphs.length > 0 ? post.paragraphs[0].substring(0, 200) + "..." : "No description available.";
                const safeTitle = post.title ? post.title.replace(/'/g, "\\'") : 'Untitled Post';

                const cardWrapper = document.createElement('div');
                cardWrapper.innerHTML = `<div class="post-card" data-id="${post.id}">
                        <div class="post-header"><div class="post-pfp"><img src="${PERMANENT_PROFILE_IMAGE_URL}" loading="lazy"></div><div class="post-meta-text">
                        <div class="name-row"><h3>Secret Binodon</h3><span class="post-username">@SecretBinodon</span><span class="dot-separator">¬∑</span><span class="time-ago">${timeAgo(post.uploadTime)}</span></div></div></div>
                        <div class="clickable-area" onclick="openPost('${post.id}')"><div class="post-title">${post.title || 'Untitled Post'}</div><div class="post-excerpt">${excerpt} <span class="read-more-text">See more</span></div></div>
                        <div class="hashtags">${post.hashtags || ''}</div>
                        <div class="clickable-area" onclick="openPost('${post.id}')"><div class="media-container"><img src="${post.mediaImage}" loading="lazy"><div class="play-icon"></div><div class="duration-badge">${post.videoDuration || '0:00'}</div></div></div>
                        <div class="post-footer"><div class="footer-left"><i class="fa-solid fa-chart-simple"></i> <span class="count-text view-count">0</span> <span class="label-text">Views</span></div><div class="footer-right">
                        <div class="love-btn"><i class="fa-regular fa-heart"></i> <span class="count-text like-count">0</span> <span class="label-text">Likes</span></div>
                        <div class="post-date-display">${formatDate(post.uploadTime)}</div>
                        <div class="footer-share-btn" onclick="sharePost('${post.id}', '${safeTitle}')"><i class="fa-solid fa-share-from-square"></i></div></div></div>
                    </div>`;
                
                const newCard = cardWrapper.firstElementChild;
                container.appendChild(newCard);
                initializeFirebaseForCard(post.id, false, newCard);
            });

            homeCurrentIndex += size;
            
            if (size === CONFIG.HOME_BATCH_SIZE) {
                sentinel.classList.remove('loading');
            }
        }

        function setupHomeObserver() {
            if (homeObserver) homeObserver.disconnect();
            const sentinel = document.getElementById('home-sentinel');
            homeObserver = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting) {
                    loadNextHomeBatch(CONFIG.HOME_BATCH_SIZE);
                }
            }, { rootMargin: '200px' });
            homeObserver.observe(sentinel);
        }

        async function calculateTotalViews() {
            const totalViewsEl = document.getElementById('total-views-count');
            totalViewsEl.innerText = '0'; 
            try {
                const snap = await getDocs(collection(db, "views"));
                let total = 0;
                snap.forEach((doc) => { total += doc.data().count || 0; });
                totalViewsEl.innerText = formatCount(total);
            } catch (e) {
                console.warn("Could not calculate total views from Firestore:", e);
                totalViewsEl.innerText = 'N/A';
            }
        }
        
        async function loadFeed() {
            const feedContainer = document.getElementById('feed-container');
            feedContainer.innerHTML = `<div style="text-align:center; color:#536471; padding:20px; font-size:16px;">Loading posts...</div>`; // ‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú

            try {
                const res = await fetch('posts.json');
                if (!res.ok) {
                    throw new Error(`HTTP Error: ${res.status}. Failed to fetch 'posts.json'.`);
                }
                
                const posts = await res.json();

                // **‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡ßç‡¶Ø n.indexOf is not a function ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®:**
                // ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶Ø‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá, ‡¶Ø‡¶æ‡¶§‡ßá ‡¶è‡¶ü‡¶ø `.sort` ‡¶è‡¶¨‡¶Ç `.forEach` ‡¶è‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá ‡¶Æ‡ßá‡¶•‡¶°‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§
                if (!Array.isArray(posts)) {
                    throw new Error("Invalid JSON structure. Expected an array of posts.");
                }

                allPosts = posts.sort((a, b) => new Date(b.uploadTime).getTime() - new Date(a.uploadTime).getTime());
                document.getElementById('total-videos-count').innerText = formatCount(allPosts.length);
                calculateTotalViews();

                const savedScrollPos = sessionStorage.getItem('scrollPos');
                let batchSize = CONFIG.HOME_INITIAL_LOAD;
                homeCurrentIndex = 0;
                feedContainer.innerHTML = ''; // ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ
                document.getElementById('home-sentinel').style.display = 'flex'; // ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶ø‡¶®‡ßá‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã

                if (savedScrollPos) {
                    const estimatedCardHeight = 400; 
                    const requiredCards = Math.ceil(parseInt(savedScrollPos) / estimatedCardHeight);
                    batchSize = Math.max(CONFIG.HOME_INITIAL_LOAD, requiredCards + CONFIG.HOME_BATCH_SIZE);
                }
                
                await loadNextHomeBatch(batchSize); 
                setupHomeObserver();
                document.getElementById('main-footer').style.display = 'block';

                if (savedScrollPos) {
                    window.scrollTo(0, parseInt(savedScrollPos));
                }

            } catch (error) {
                console.error("Feed Load Error:", error);
                // ‡¶´‡ßá‡¶á‡¶≤ ‡¶π‡¶≤‡ßá‡¶ì ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡ßá‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡ßü ‡¶§‡¶æ‡¶á ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶è‡¶∞‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú
                feedContainer.innerHTML = `<div style="text-align:center; color:red; padding:20px; font-size:16px;">Error loading feed: ${error.message}. Please check 'posts.json' file or its path.</div>`;
            }
        }

        window.openPost = (id) => {
            // ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶¨‡¶®‡ßç‡¶ß‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø:
            if(window.location.search.includes('view=post')) return; 
            sessionStorage.setItem('scrollPos', window.scrollY); 
            showView('post', id);
        };
        
        // ============================================
        //  ‡ß´. ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶™‡ßá‡¶ú ‡¶≤‡¶ú‡¶ø‡¶ï
        // ============================================

        /**
         * ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ï‡ßÄ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá (‡¶Ø‡ßá‡¶Æ‡¶®: 'h-1', 'h-2', 'd-1', 'd-2')
         */
        function getTimeChunkKey(postTime, anchorTime) {
            const diffInSeconds = Math.floor((anchorTime - postTime) / 1000);
            const diffInHours = diffInSeconds / 3600;
            const diffInDays = diffInSeconds / 86400;

            if (diffInHours < 24) {
                const hoursAgo = Math.floor(diffInHours);
                return `h-${hoursAgo + 1}`; // ‡ßß ‡¶ò‡¶£‡ßç‡¶ü‡¶æ, ‡ß® ‡¶ò‡¶£‡ßç‡¶ü‡¶æ... ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ
            } else {
                const daysAgo = Math.floor(diffInDays);
                return `d-${daysAgo}`; // ‡ßß ‡¶¶‡¶ø‡¶®, ‡ß® ‡¶¶‡¶ø‡¶®...
            }
        }

        function renderMainPost(post) {
            let content = `<h1 class="article-title">${post.title || 'Untitled Post'}</h1>`;
            const totalPara = post.paragraphs ? post.paragraphs.length : 0;
            
            if(post.paragraphs) {
                post.paragraphs.forEach((p, i) => {
                    content += `<p class="article-para">${p}</p>`;
                    if (totalPara <= 2) {
                        if (i === 0 && post.downloadLink1) content += `<a href="${post.downloadLink1}" class="download-btn" style="background:${getRandomColor()}">DOWNLOAD FULL VIDEO</a>`;
                    } else {
                        if (i === 0 && post.downloadLink1) content += `<a href="${post.downloadLink1}" class="download-btn" style="background:${getRandomColor()}">DOWNLOAD FULL VIDEO</a>`;
                        if (i === totalPara - 2 && post.downloadLink2) content += `<a href="${post.downloadLink2}" class="download-btn" style="background:${getRandomColor()}">DOWNLOAD FULL VIDEO</a>`;
                    }
                });
            } else {
                 content += `<p class="article-para">No detailed content available for this post.</p>`;
            }


            document.getElementById('post-details-container').innerHTML = `
                <div class="post-author-area">
                    <div class="author-info">
                        <div class="pfp"><img src="${PERMANENT_PROFILE_IMAGE_URL}"></div>
                        <div class="author-text"><h3>Secret Binodon</h3><span>@SecretBinodon</span></div>
                    </div>
                    <div class="post-time">${timeAgo(post.uploadTime)}</div>
                </div>
                <div class="video-container" onclick="handleVideoClick()"><img src="${post.mediaImage}"><div class="play-btn-center" id="main-play-btn"></div><div class="main-video-spinner" id="main-spinner"></div><div class="video-controls"><span>${post.videoDuration || '0:00'}</span><span><i class="fa-solid fa-volume-high"></i> HD</span></div></div>
                <div class="content-body">${content}<div class="stats-section"><div class="stats-left"><div class="view-stat"><i class="fa-solid fa-chart-simple"></i> <span id="view-cnt">...</span> Views</div><div class="like-stat-container"><div class="love-btn" id="main-like-btn"><i class="fa-regular fa-heart"></i> <span id="like-cnt">...</span> Likes</div></div></div><div class="share-icons"><div class="share-icon" style="background:#1877f2" onclick="share('fb', '${post.title ? post.title.replace(/'/g, "\\'") : 'Untitled Post'}')"><i class="fa-brands fa-facebook-f"></i></div><div class="share-icon" style="background:#0084ff" onclick="share('msg', '${post.title ? post.title.replace(/'/g, "\\'") : 'Untitled Post'}')"><i class="fa-brands fa-facebook-messenger"></i></div><div class="share-icon" style="background:#25d366" onclick="share('wa', '${post.title ? post.title.replace(/'/g, "\\'") : 'Untitled Post'}')"><i class="fa-brands fa-whatsapp"></i></div><div class="share-icon" style="background:#1da1f2" onclick="share('tw', '${post.title ? post.title.replace(/'/g, "\\'") : 'Untitled Post'}')"><i class="fa-brands fa-twitter"></i></div><div class="share-icon" style="background:#0088cc" onclick="share('tg', '${post.title ? post.title.replace(/'/g, "\\'") : 'Untitled Post'}')"><i class="fa-brands fa-telegram"></i></div></div></div></div>`;
        }


        async function initPostView(postId) {
            document.getElementById('related-posts-container').innerHTML = ''; // ‡¶∞‡¶ø‡¶≤‡ßá‡¶ü‡ßá‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ
            document.getElementById('post-details-container').innerHTML = `<div style="padding:40px; text-align:center; color:#666;"><span class="spinner" style="width:24px; height:24px;"></span> Loading post...</div>`; // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞

            try {
                const res = await fetch('posts.json');
                if(!res.ok) throw new Error("Failed to load posts data.");
                const posts = await res.json();
                
                if (!Array.isArray(posts)) {
                    throw new Error("Invalid JSON structure for posts data.");
                }

                const mainPost = posts.find(p => p.id === postId) || posts[0];
                if (!mainPost) throw new Error("Post not found.");

                renderMainPost(mainPost);
                // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶∏ ‡¶ï‡¶∞‡¶æ
                initializeFirebaseForCard(mainPost.id, true); 
                
                anchorPostTime = new Date(mainPost.uploadTime).getTime();
                
                // ‡¶∞‡¶ø‡¶≤‡ßá‡¶ü‡ßá‡¶° ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï
                const historicalPosts = posts
                    .filter(p => p.id !== mainPost.id && new Date(p.uploadTime).getTime() < anchorPostTime)
                    .sort((a, b) => new Date(a.uploadTime).getTime() - new Date(b.uploadTime).getTime());

                postsByTimeChunk = historicalPosts.reduce((acc, post) => {
                    const postTime = new Date(post.uploadTime).getTime();
                    const key = getTimeChunkKey(postTime, anchorPostTime);
                    if (!acc[key]) acc[key] = [];
                    acc[key].push(post);
                    return acc;
                }, {});

                const sortedKeys = Object.keys(postsByTimeChunk).sort((a, b) => {
                    const aType = a.split('-')[0], aNum = parseInt(a.split('-')[1]);
                    const bType = b.split('-')[0], bNum = parseInt(b.split('-')[1]);
                    
                    if (aType === 'h' && bType === 'd') return -1;
                    if (aType === 'd' && bType === 'h') return 1;
                    return aNum - bNum;
                });

                allRelatedPosts = sortedKeys;
                relatedCurrentChunkIndex = 0;
                remainingInChunk = [];
                document.getElementById('related-sentinel').style.display = 'flex'; // ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶ø‡¶®‡ßá‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                
                loadNextRelatedBatch(CONFIG.RELATED_INITIAL_LOAD);
                setupRelatedObserver();

            } catch (e) { 
                console.error("Post View Init Error:", e);
                document.getElementById('post-details-container').innerHTML = `<div style="padding:20px;text-align:center;color:red;">Error loading post: ${e.message}</div>`; 
                document.getElementById('related-sentinel').style.display = 'none';
            }
        }

        function loadNextRelatedBatch(size = CONFIG.RELATED_BATCH_SIZE) {
            const container = document.getElementById('related-posts-container');
            const sentinel = document.getElementById('related-sentinel');
            
            if (relatedCurrentChunkIndex >= allRelatedPosts.length && remainingInChunk.length === 0) {
                sentinel.style.display = 'none';
                return;
            }

            sentinel.classList.add('loading');
            let postsToLoad = [];
            let neededCount = size;

            if (remainingInChunk.length > 0) {
                const takeFromRemaining = Math.min(neededCount, remainingInChunk.length);
                postsToLoad.push(...remainingInChunk.splice(0, takeFromRemaining));
                neededCount -= takeFromRemaining;
            }

            while (neededCount > 0 && relatedCurrentChunkIndex < allRelatedPosts.length) {
                const chunkKey = allRelatedPosts[relatedCurrentChunkIndex];
                const currentChunkPosts = postsByTimeChunk[chunkKey];

                const takeFromChunk = Math.min(neededCount, currentChunkPosts.length);
                postsToLoad.push(...currentChunkPosts.splice(0, takeFromChunk));
                neededCount -= takeFromChunk;

                if (currentChunkPosts.length === 0) {
                    relatedCurrentChunkIndex++;
                } else if (neededCount === 0) {
                    remainingInChunk = currentChunkPosts;
                }
            }
            
            postsToLoad.forEach(post => {
                let excerpt = post.paragraphs && post.paragraphs.length > 0 ? post.paragraphs[0].substring(0, 200) + "..." : "No description available.";
                const safeTitle = post.title ? post.title.replace(/'/g, "\\'") : 'Untitled Post';
                
                const cardWrapper = document.createElement('div');
                cardWrapper.innerHTML = `
                    <div class="post-card" data-id="${post.id}">
                        <div class="post-header"><div class="post-pfp"><img src="${PERMANENT_PROFILE_IMAGE_URL}" loading="lazy"></div><div class="post-meta-text"><div class="name-row"><h3>Secret Binodon</h3><span class="post-username">@SecretBinodon</span><span class="dot-separator">¬∑</span><span class="time-ago">${timeAgo(post.uploadTime)}</span></div></div></div>
                        <div class="clickable-area" onclick="openPost('${post.id}')"><div class="post-title">${post.title || 'Untitled Post'}</div><div class="post-excerpt">${excerpt} <span class="read-more-text">See more</span></div></div>
                        <div class="hashtags">${post.hashtags || ''}</div>
                        <div class="clickable-area" onclick="openPost('${post.id}')"><div class="media-container"><img src="${post.mediaImage}" loading="lazy"><div class="play-icon"></div><div class="duration-badge">${post.videoDuration || '0:00'}</div></div></div>
                        <div class="post-footer"><div class="footer-left"><i class="fa-solid fa-chart-simple"></i> <span class="count-text view-count-rel">...</span> <span class="label-text">Views</span></div><div class="footer-right"><div class="love-btn-rel"><i class="fa-regular fa-heart"></i> <span class="count-text like-count-rel">...</span> <span class="label-text">Likes</span></div><div class="post-date-display">${formatDate(post.uploadTime)}</div><div class="footer-share-btn" onclick="sharePost('${post.id}', '${safeTitle}')"><i class="fa-solid fa-share-from-square"></i></div></div></div>
                    </div>`;
                
                const newCard = cardWrapper.firstElementChild;
                container.appendChild(newCard);
                initializeFirebaseForCard(post.id, false, newCard);
            });

            sentinel.classList.remove('loading');
            if (relatedCurrentChunkIndex >= allRelatedPosts.length && remainingInChunk.length === 0) {
                sentinel.style.display = 'none';
            }
        }

        function setupRelatedObserver() {
            if (relatedObserver) relatedObserver.disconnect();
            const sentinel = document.getElementById('related-sentinel');
            relatedObserver = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting) {
                    setTimeout(() => loadNextRelatedBatch(CONFIG.RELATED_BATCH_SIZE), 500); 
                }
            }, { rootMargin: '100px' });
            relatedObserver.observe(sentinel);
        }

        window.handleVideoClick = function() {
            const p = document.getElementById('main-play-btn'), s = document.getElementById('main-spinner');
            if(p) p.style.display = 'none'; if(s) s.style.display = 'block';
            setTimeout(() => { window.location.href = CONFIG.GLOBAL_VIDEO_LINK; }, 100); 
        }
        window.addEventListener('pageshow', () => {
            const p = document.getElementById('main-play-btn'), s = document.getElementById('main-spinner');
            if(p) p.style.display = 'flex'; if(s) s.style.display = 'none';
        });

        window.share = (platform, title) => {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(title);
            if (platform === 'msg') {
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                if (isMobile) window.location.href = `fb-messenger://share/?link=${url}`;
                else window.open(`https://www.facebook.com/dialog/send?link=${url}&app_id=123456789&redirect_uri=${url}`, '_blank');
            } else {
                let link = '';
                if(platform === 'fb') link = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                else if(platform === 'wa') link = `https://wa.me/?text=${text}%20${url}`;
                else if(platform === 'tw') link = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
                else if(platform === 'tg') link = `https://t.me/share/url?url=${url}&text=${text}`;
                window.open(link, '_blank');
            }
        }

        // ============================================
        //  ‡ß¨. ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶è‡¶ï‡¶§‡ßç‡¶∞‡¶ø‡¶§)
        // ============================================

        function initializeFirebaseForCard(id, isMainPost, cardElement = null) {
            
            let viewEl, likeEl, loveBtn;
            if (isMainPost) {
                viewEl = document.getElementById('view-cnt');
                likeEl = document.getElementById('like-cnt');
                loveBtn = document.getElementById('main-like-btn');
                // ‡¶Æ‡ßá‡¶á‡¶® ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶â ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                setDoc(doc(db, "views", id), { count: increment(1) }, { merge: true }).catch(e => console.warn("Firestore view increment failed:", e));
            } else {
                // ‡¶∞‡¶ø‡¶≤‡ßá‡¶ü‡ßá‡¶° ‡¶¨‡¶æ ‡¶π‡ßã‡¶Æ ‡¶´‡¶ø‡¶° ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá
                viewEl = cardElement.querySelector('.view-count-rel') || cardElement.querySelector('.view-count');
                likeEl = cardElement.querySelector('.like-count-rel') || cardElement.querySelector('.like-count');
                loveBtn = cardElement.querySelector('.love-btn-rel') || cardElement.querySelector('.love-btn');
            }

            // ‡¶≠‡¶ø‡¶â ‡¶ì ‡¶≤‡¶æ‡¶á‡¶ï ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            onSnapshot(doc(db, "views", id), (s) => viewEl.innerText = formatCount(s.data()?.count || 0), (e) => console.warn("Views Snapshot failed:", e));
            const loveRef = doc(db, "loves", id);
            const userRef = doc(db, `loves/${id}/users`, deviceId);
            onSnapshot(loveRef, (s) => likeEl.innerText = formatCount(s.data()?.count || 0), (e) => console.warn("Loves Snapshot failed:", e));

            // ‡¶≤‡¶æ‡¶á‡¶ï ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï
            getDoc(userRef).then(s => { 
                if(s.exists()) { 
                    loveBtn.classList.add('liked'); 
                    loveBtn.querySelector('i').classList.replace('fa-regular', 'fa-solid'); 
                } 
            }).catch(e => console.warn("Liked status check failed:", e));

            // ‡¶≤‡¶æ‡¶á‡¶ï ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
            loveBtn.addEventListener('click', async () => {
                const s = await getDoc(userRef).catch(e => { console.error("Error getting user like status:", e); return null; });
                if(s && s.exists()) { 
                    showNotification("Already liked! ‚ù§Ô∏è"); 
                } else {
                    try {
                        loveBtn.classList.add('liked'); 
                        loveBtn.querySelector('i').classList.replace('fa-regular', 'fa-solid');
                        await setDoc(loveRef, { count: increment(1) }, { merge: true });
                        await setDoc(userRef, { time: new Date() });
                        showNotification("Liked! ‚ù§Ô∏è");
                    } catch (e) {
                        console.error("Error updating like status:", e);
                        loveBtn.classList.remove('liked'); // ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßá ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º ‡¶´‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶®‡¶æ
                        loveBtn.querySelector('i').classList.replace('fa-solid', 'fa-regular');
                        showNotification("Failed to like the post. Please try again.");
                    }
                }
            });
        }

        // ============================================
        //  ‡ß≠. ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® ‡¶ì ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø
        // ============================================
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            document.getElementById('loginBtn').innerText='Logging in...';
            setTimeout(() => { document.getElementById('loginBtn').style.display='none'; document.getElementById('successMsg').style.display='block'; }, 2000);
        });

        // ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        document.getElementById('link-about').href = CONFIG.footer.about;
        document.getElementById('link-contact').href = CONFIG.footer.contact;
        document.getElementById('link-privacy').href = CONFIG.footer.privacy;
        document.getElementById('link-terms').href = CONFIG.footer.terms;

        // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶ø‡¶Ç ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶™‡¶ú‡¶ø‡¶∂‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
        if ('scrollRestoration' in history) { history.scrollRestoration = 'manual'; }
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            if (document.getElementById('home-view').style.display !== 'none') {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => { sessionStorage.setItem('scrollPos', window.scrollY); }, 100); 
            }
        });

        // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡¶†‡¶ø‡¶ï ‡¶≠‡¶ø‡¶â ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
        handleUrlChange(); 
    </script>
</body>
</html>
