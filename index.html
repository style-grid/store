<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Binodon - Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-decoration: none; }
        body { background-color: #ffffff; display: flex; justify-content: center; }
        
        /* ‡¶Æ‡ßá‡¶á‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
        .main-container {
            background-color: white; width: 100%; max-width: 600px;
            min-height: 100vh; border-left: 1px solid #ddd; border-right: 1px solid #ddd;
            position: relative; padding-bottom: 0;
        }

        /* --- ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶π‡ßá‡¶°‡¶æ‡¶∞ --- */
        .cover-photo { width: 100%; height: 160px; background-color: #ddd; overflow: hidden; position: relative; }
        .cover-photo img { width: 100%; height: 100%; object-fit: cover; }

        .profile-header-area { position: relative; padding: 0 15px; display: flex; justify-content: space-between; align-items: flex-start; }
        .profile-pic-container { margin-top: -75px; z-index: 2; }
        .profile-pic { width: 140px; height: 140px; border-radius: 50%; border: 4px solid white; background-color: #000; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        .profile-pic img { width: 100%; height: 100%; object-fit: cover; }

        .action-buttons { display: flex; gap: 8px; margin-top: 10px; }
        .btn { border: none; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold; color: white; cursor: pointer; display: flex; align-items: center; gap: 5px; transition: transform 0.1s; }
        .btn:active { transform: scale(0.95); }
        .btn-email { background-color: #1da1f2; }
        .btn-share { background-color: #000; }

        .info-section { padding: 5px 15px 15px 15px; }
        .website-name { font-size: 22px; font-weight: 800; color: #1c1e21; text-transform: uppercase; }
        .username { font-size: 15px; color: #65676b; margin-bottom: 8px; }
        .stats { font-size: 14px; color: #050505; margin-bottom: 8px; }
        .stats b { font-weight: 800; }
        .meta-info { display: flex; gap: 15px; color: #65676b; font-size: 13px; margin-bottom: 12px; align-items: center; }
        .meta-info i { margin-right: 4px; }
        .bio { font-size: 14px; color: #1c1e21; line-height: 1.4; text-align: justify; margin-bottom: 15px; }

        /* --- ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞ --- */
        .nav-bar {
            display: flex; gap: 10px; padding: 10px 15px;
            border-top: 1px solid #e1e8ed; border-bottom: 1px solid #e1e8ed;
            margin-bottom: 5px; background: #fff; position: sticky; top: 0; z-index: 100;
        }
        .nav-btn {
            padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold;
            cursor: pointer; border: 1px solid #e1e8ed; display: flex; align-items: center;
            gap: 6px; transition: background-color 0.1s ease;
        }
        .nav-btn.active { background-color: #000 !important; color: white !important; border: 1px solid #000 !important; }
        .nav-btn.inactive { background-color: #f0f2f5; color: #000; }
        .nav-btn:hover { background-color: #e4e6eb; }

        /* --- ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® --- */
        #feed-container { min-height: 200px; }
        
        .post-card { 
            padding: 15px; border-bottom: 1px solid #e1e8ed; 
            display: flex; flex-direction: column; 
            /* ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶ì ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ */
            gap: 6px; 
            background: white; opacity: 0; animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn { to { opacity: 1; } }

        .post-header { display: flex; gap: 10px; align-items: center; }
        .post-pfp { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; background-color: #ddd; }
        .post-pfp img { width: 100%; height: 100%; object-fit: cover; }
        
        .post-meta-text { display: flex; flex-direction: column; justify-content: center; }
        .name-row { display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
        
        /* ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶® (18px) */
        .name-row h3 { font-size: 18px; font-weight: 800; color: #0f1419; margin: 0; }
        
        /* ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶π‡ßç‡¶∞‡¶æ‡¶∏ (‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶•‡ßá‡¶ï‡ßá) */
        .post-username { font-size: 14px; color: #536471; }
        
        .time-ago { font-size: 15px; color: #536471; }
        .dot-separator { font-size: 15px; color: #536471; margin: 0 2px; }

        .clickable-area { cursor: pointer; }
        
        /* ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú (18px) ‡¶è‡¶¨‡¶Ç ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶®‡¶ø‡¶Ø‡¶º‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ */
        .post-title { 
            font-size: 18px; /* ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú */
            font-weight: 700; 
            color: #0f1419; 
            margin-bottom: 8px; /* ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ */
            margin-top: -3px; /* ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã */
            line-height: 1.3; 
        }
        
        .post-excerpt { 
            font-size: 15px; color: #0f1419; line-height: 1.4; margin-bottom: 8px;
            display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;
        }
        .read-more-text { color: #1da1f2; font-weight: 600; font-size: 14px; }
        .hashtags { color: #1d9bf0; font-size: 15px; margin-bottom: 10px; cursor: default; }

        .media-container {
            position: relative; width: 100%; border-radius: 12px; overflow: hidden;
            margin-top: 5px; display: block; max-height: 720px; cursor: pointer; background: #000;
        }
        .media-container img { width: 100%; height: auto; display: block; object-fit: contain; margin: 0 auto; max-height: 720px; }
        
        .play-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60px; height: 60px; background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            pointer-events: none; border: 2px solid rgba(255,255,255,0.8);
        }
        .play-icon::after {
            content: ''; display: block; width: 0; height: 0;
            border-left: 18px solid white; border-top: 11px solid transparent;
            border-bottom: 11px solid transparent; margin-left: 4px;
        }

        .duration-badge {
            position: absolute; bottom: 8px; right: 8px;
            background-color: rgba(0, 0, 0, 0.8); color: white;
            padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold;
            pointer-events: none; z-index: 5;
        }

        .post-footer {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 12px; color: #536471; font-size: 16px; font-weight: 500;
        }
        .footer-left { display: flex; align-items: center; gap: 6px; }
        .footer-right { display: flex; align-items: center; gap: 20px; }

        .love-btn { cursor: pointer; display: flex; align-items: center; gap: 5px; transition: all 0.2s; user-select: none; }
        .love-btn:hover { color: #e0245e; background-color: rgba(224, 36, 94, 0.1); padding: 4px 8px; border-radius: 15px; margin: -4px -8px; }
        .love-btn.liked { color: #e0245e; } .love-btn.liked i { font-weight: 900; }
        
        .count-text { font-weight: bold; }
        .label-text { font-weight: normal; font-size: 15px; }
        .post-date-display { font-size: 14px; color: #65676b; }

        .footer-share-btn {
            cursor: pointer; padding: 8px; border-radius: 50%; transition: all 0.2s ease;
            display: flex; align-items: center; justify-content: center;
        }
        .footer-share-btn:hover { background-color: rgba(0,0,0,0.05); }

        /* Infinite Scroll Loader */
        #sentinel { width: 100%; height: 50px; display: flex; align-items: center; justify-content: center; }
        .load-more-spinner {
            width: 30px; height: 30px; border: 3px solid #ccc; border-top: 3px solid #1da1f2;
            border-radius: 50%; animation: spin 1s linear infinite; display: none;
        }
        #sentinel.loading .load-more-spinner { display: block; }

        /* ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® */
        .site-footer { background-color: #fff; padding: 30px 20px; text-align: center; border-top: none; margin-top: 0; }
        .footer-links { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 15px; }
        .footer-links a { color: #536471; font-size: 14px; font-weight: 500; transition: color 0.2s; }
        .footer-links a:hover { color: #1da1f2; text-decoration: underline; }
        .footer-copyright { color: #536471; font-size: 13px; }
        .footer-copyright a { color: #1da1f2; font-weight: bold; }

        /* ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßá‡¶ú */
        #login-view { display: none; padding: 40px 20px; text-align: center; }
        .login-box { background: white; padding: 30px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto; }
        .login-logo { width: 60px; height: 60px; margin-bottom: 20px; border-radius: 50%; }
        .login-submit-btn { width: 100%; padding: 12px; background-color: #000; color: white; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .success-msg { color: green; font-weight: bold; margin-top: 15px; display: none; }

        .spinner { width: 14px; height: 14px; border: 2px solid #ccc; border-top: 2px solid #000; border-radius: 50%; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .notification {
            position: fixed; top: 70px; left: 50%; transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.85); color: white; padding: 10px 20px;
            border-radius: 30px; z-index: 1002; opacity: 0; transition: opacity 0.3s;
            font-size: 14px; pointer-events: none;
        }
        .notification.show { opacity: 1; }

    </style>
</head>
<body>

    <div class="main-container">
        <div class="cover-photo">
            <img src="https://e0.pxfuel.com/wallpapers/114/575/desktop-wallpaper-stephanie-potrait-eyes-girls-eyes-eyes-gorgeous-eyes-arabic-eyes.jpg">
        </div>

        <div class="profile-header-area">
            <div class="profile-pic-container">
                <div class="profile-pic">
                    <img src="https://raw.githubusercontent.com/style-grid/store/refs/heads/main/data/20251211_024630.jpg">
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-email" onclick="sendEmail()">
                    <i class="fa-solid fa-envelope"></i> Send Email
                </button>
                <button class="btn btn-share" onclick="shareProfile()">
                    <i class="fa-solid fa-share-nodes"></i> Share
                </button>
            </div>
        </div>

        <div class="info-section">
            <h1 class="website-name">SECRET BINODON</h1>
            <p class="username">@SecretBinodon</p>

            <div class="stats">
                <span>Total Videos <b id="total-videos-count"><span class="spinner"></span></b></span> ‚Ä¢ 
                <span>Total Views <b id="total-views-count"><span class="spinner"></span></b></span>
            </div>

            <div class="meta-info">
                <span><i class="fa-solid fa-location-dot"></i>üá∫üá≤ United States</span>
                <span><i class="fa-regular fa-calendar"></i>Joined 08/03/2023</span>
            </div>

            <p class="bio">
                Secret Binodon this is one of the most popular and best websites for Secret Binodon Viral Video, YouTube Viral Video, Facebook Viral Video, Instagram Viral Video, TikTok Viral Video and much more. Which can be very helpful for your daily life.
            </p>
        </div>

        <div class="nav-bar">
            <div class="nav-btn active" id="nav-home" onclick="showFeed()"><i class="fa-solid fa-house"></i> Home</div>
            <div class="nav-btn inactive" id="nav-signup" onclick="goToSignUp()"><i class="fa-solid fa-user-plus"></i> Sign Up</div>
            <div class="nav-btn inactive" id="nav-login" onclick="showLogin()"><i class="fa-solid fa-arrow-right-to-bracket"></i> Login</div>
        </div>

        <div id="feed-container">
            <div id="loading-msg">Loading latest posts...</div>
        </div>
        
        <div id="sentinel"><div class="load-more-spinner"></div></div>

        <footer class="site-footer" id="main-footer" style="display:none;">
            <div class="footer-links">
                <a href="#" id="link-about">About</a>
                <a href="#" id="link-contact">Contact</a>
                <a href="#" id="link-privacy">Privacy Policy</a>
                <a href="#" id="link-terms">Terms of Service</a>
            </div>
            <div class="footer-copyright">
                Copyright ¬© 2025 <a href="index.html">SecretBinodon.com</a>. All rights reserved.
            </div>
        </footer>

        <div id="login-view">
            <div class="login-box">
                <img src="https://raw.githubusercontent.com/style-grid/store/refs/heads/main/data/20251211_024630.jpg">
                <h2 class="login-title">Log in to Secret Binodon</h2>
                <form id="loginForm">
                    <div style="text-align:left; margin-bottom:15px;"><label>Email</label><input type="text" placeholder="Enter email" required style="width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:5px;"></div>
                    <div style="text-align:left; margin-bottom:15px;"><label>Password</label><input type="password" placeholder="Enter password" required style="width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:5px;"></div>
                    <button type="submit" class="login-submit-btn" id="loginBtn">Log in</button>
                    <div class="success-msg" id="successMsg"><i class="fa-solid fa-check-circle"></i> Login Successful!</div>
                </form>
            </div>
        </div>
        
        <div id="notification" class="notification"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, increment, onSnapshot, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        // ============================================
        //  ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶á‡¶Æ‡ßá‡¶ú URL 
        // ============================================
        const PERMANENT_PROFILE_IMAGE_URL = "https://raw.githubusercontent.com/style-grid/store/refs/heads/main/data/20251211_024630.jpg";
        // ‡¶è‡¶á URL ‡¶ü‡¶ø‡¶á ‡¶è‡¶ñ‡¶® ‡¶∏‡¶¨ ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶π‡¶¨‡ßá‡•§

        const firebaseConfig = { apiKey: "AIzaSyCAsD8wucLsudzY5oNbiixLGyjN2apdV0Q", authDomain: "my-ad-analytics-4560a.firebaseapp.com", databaseURL: "https://my-ad-analytics-4560a-default-rtdb.firebaseio.com", projectId: "my-ad-analytics-4560a", storageBucket: "my-ad-analytics-4560a.firebasestorage.app", messagingSenderId: "104213283950", appId: "1:104213283950:web:b5a25ecd54df809625127f", measurementId: "G-WS7QSQ9H0Y" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const deviceId = localStorage.getItem('deviceId') || 'device-' + Date.now();
        localStorage.setItem('deviceId', deviceId);

        // ============================================
        //  CONFIGURATION & EMAIL SETTINGS
        // ============================================
        const CONFIG = {
            INITIAL_LOAD: 20,
            BATCH_SIZE: 20,
            CONTACT_EMAIL: "contact@secretbinodon.com", // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®
            footer: { about: "#", contact: "#", privacy: "#", terms: "#" }
        };

        // Footer Links Setup
        document.getElementById('link-about').href = CONFIG.footer.about;
        document.getElementById('link-contact').href = CONFIG.footer.contact;
        document.getElementById('link-privacy').href = CONFIG.footer.privacy;
        document.getElementById('link-terms').href = CONFIG.footer.terms;

        let allPosts = [];
        let currentIndex = 0;
        let observer;

        function formatCount(num) { if (!num) return 0; return num >= 1000000 ? (num/1000000).toFixed(1)+'M' : num >= 1000 ? (num/1000).toFixed(1)+'K' : num; }
        
        function timeAgo(dateString) {
            const s = Math.floor((new Date() - new Date(dateString)) / 1000);
            let i = s / 31536000; if (i > 1) return Math.floor(i) + "y ago";
            i = s / 86400; if (i > 1) return Math.floor(i) + "d ago";
            i = s / 3600; if (i > 1) return Math.floor(i) + "h ago";
            return "Just now";
        }
        function formatDate(d) { return new Date(d).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }); }
        function showNotification(msg) { const n = document.getElementById('notification'); n.textContent = msg; n.classList.add('show'); setTimeout(() => n.classList.remove('show'), 3000); }

        // --- EMAIL & PROFILE SHARE FUNCTIONS ---
        
        // ‡ßß. ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
        window.sendEmail = function() {
            window.location.href = `mailto:${CONFIG.CONTACT_EMAIL}`;
        }

        // ‡ß®. ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ (‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶π‡ßã‡¶Æ‡¶™‡ßá‡¶ú ‡¶≤‡¶ø‡¶Ç‡¶ï)
        window.shareProfile = function() {
            const url = window.location.href.split('?')[0]; // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶π‡ßã‡¶Æ ‡¶≤‡¶ø‡¶Ç‡¶ï
            const title = "Secret Binodon";
            const text = "Secret Binodon - The #1 Platform for Viral Videos! üé• Watch the latest trending videos all in one place. Visit now!";

            if (navigator.share) {
                navigator.share({
                    title: title,
                    text: text,
                    url: url
                }).catch((error) => console.log('Share failed', error));
            } else {
                navigator.clipboard.writeText(`${text} ${url}`);
                showNotification("Website link copied! üìã");
            }
        }

        // --- POST SHARE FUNCTION (CARD) ---
        window.sharePost = function(id, title) {
            const url = window.location.origin + `/post.html?id=${id}`;
            if (navigator.share) { navigator.share({ title: title, text: title, url: url }).catch((e) => console.log('Share failed', e)); }
            else { navigator.clipboard.writeText(url); showNotification("Link copied! üìã"); }
        }

        async function loadFeed() {
            try {
                const res = await fetch('posts.json');
                const posts = await res.json();
                
                document.getElementById('total-videos-count').innerText = formatCount(posts.length);
                calculateTotalViews();

                allPosts = posts;
                document.getElementById('loading-msg').style.display = 'none';
                
                loadNextBatch();
                setupObserver();
                document.getElementById('main-footer').style.display = 'block';

            } catch (error) {
                console.error(error);
                document.getElementById('loading-msg').innerText = "Failed to load posts.";
            }
        }

        function loadNextBatch() {
            const container = document.getElementById('feed-container');
            const sentinel = document.getElementById('sentinel');

            if (currentIndex >= allPosts.length) {
                sentinel.style.display = 'none';
                return;
            }

            sentinel.classList.add('loading');

            const batch = allPosts.slice(currentIndex, currentIndex + CONFIG.BATCH_SIZE);
            
            batch.forEach(post => {
                let excerpt = post.paragraphs && post.paragraphs.length > 0 ? post.paragraphs[0].substring(0, 200) + "..." : "No description available.";
                const safeTitle = post.title.replace(/'/g, "\\'");

                const cardWrapper = document.createElement('div');
                cardWrapper.innerHTML = `
                    <div class="post-card" data-id="${post.id}">
                        <div class="post-header">
                            <div class="post-pfp"><img src="${PERMANENT_PROFILE_IMAGE_URL}" loading="lazy"></div>
                            <div class="post-meta-text">
                                <div class="name-row"><h3>Secret Binodon</h3><span class="post-username">@SecretBinodon</span><span class="dot-separator">¬∑</span><span class="time-ago">${timeAgo(post.uploadTime)}</span></div>
                            </div>
                        </div>
                        <div class="clickable-area" onclick="openPost('${post.id}')">
                            <div class="post-title">${post.title}</div>
                            <div class="post-excerpt">${excerpt} <span class="read-more-text">See more</span></div>
                        </div>
                        <div class="hashtags">${post.hashtags}</div>
                        <div class="clickable-area" onclick="openPost('${post.id}')">
                            <div class="media-container">
                                <img src="${post.mediaImage}" loading="lazy">
                                <div class="play-icon"></div>
                                <div class="duration-badge">${post.videoDuration}</div>
                            </div>
                        </div>
                        <div class="post-footer">
                            <div class="footer-left"><i class="fa-solid fa-chart-simple"></i> <span class="count-text view-count"><span class="spinner"></span></span> <span class="label-text">Views</span></div>
                            <div class="footer-right">
                                <div class="love-btn"><i class="fa-regular fa-heart"></i> <span class="count-text like-count"><span class="spinner"></span></span> <span class="label-text">Likes</span></div>
                                <div class="post-date-display">${formatDate(post.uploadTime)}</div>
                                <div class="footer-share-btn" onclick="sharePost('${post.id}', '${safeTitle}')"><i class="fa-solid fa-share-from-square"></i></div>
                            </div>
                        </div>
                    </div>`;
                
                const newCard = cardWrapper.firstElementChild;
                container.appendChild(newCard);
                initializeFirebaseForCard(newCard, post.id);
            });

            currentIndex += CONFIG.BATCH_SIZE;
            sentinel.classList.remove('loading');
        }

        function setupObserver() {
            const sentinel = document.getElementById('sentinel');
            observer = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting) {
                    setTimeout(() => loadNextBatch(), 500);
                }
            }, { rootMargin: '200px' });
            observer.observe(sentinel);
        }

        function initializeFirebaseForCard(card, id) {
            const viewEl = card.querySelector('.view-count');
            const likeEl = card.querySelector('.like-count');
            const loveBtn = card.querySelector('.love-btn');

            onSnapshot(doc(db, "views", id), (s) => viewEl.innerText = formatCount(s.data()?.count || 0));

            const loveRef = doc(db, "loves", id);
            const userRef = doc(db, `loves/${id}/users`, deviceId);

            getDoc(userRef).then(s => { if(s.exists()) { loveBtn.classList.add('liked'); loveBtn.querySelector('i').classList.replace('fa-regular', 'fa-solid'); } });
            onSnapshot(loveRef, (s) => likeEl.innerText = formatCount(s.data()?.count || 0));

            loveBtn.addEventListener('click', async () => {
                const s = await getDoc(userRef);
                if(s.exists()) { showNotification("Already liked! ‚ù§Ô∏è"); } 
                else {
                    loveBtn.classList.add('liked'); loveBtn.querySelector('i').classList.replace('fa-regular', 'fa-solid');
                    await setDoc(loveRef, { count: increment(1) }, { merge: true });
                    await setDoc(userRef, { time: new Date() });
                    showNotification("Liked! ‚ù§Ô∏è");
                }
            });
        }

        async function calculateTotalViews() {
            const snap = await getDocs(collection(db, "views"));
            let total = 0;
            snap.forEach((doc) => { total += doc.data().count || 0; });
            document.getElementById('total-views-count').innerText = formatCount(total);
        }

        window.openPost = (id) => window.location.href = `post.html?id=${id}`;
        
        window.showFeed = () => {
            document.getElementById('feed-container').style.display='block';
            document.getElementById('sentinel').style.display='flex';
            document.getElementById('login-view').style.display='none';
            document.getElementById('main-footer').style.display='block';
            document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('active'); b.classList.add('inactive'); });
            document.getElementById('nav-home').classList.add('active');
            document.getElementById('nav-home').classList.remove('inactive');
        };
        window.goToSignUp = () => window.location.href="https://www.example.com/signup";
        window.showLogin = () => {
            document.getElementById('feed-container').style.display='none';
            document.getElementById('sentinel').style.display='none';
            document.getElementById('login-view').style.display='block';
            document.getElementById('main-footer').style.display='none';
            document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('active'); b.classList.add('inactive'); });
            document.getElementById('nav-login').classList.add('active');
            document.getElementById('nav-login').classList.remove('inactive');
        };

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            document.getElementById('loginBtn').innerText='Logging in...';
            setTimeout(() => { document.getElementById('loginBtn').style.display='none'; document.getElementById('successMsg').style.display='block'; }, 2000);
        });

        loadFeed();
    </script>
</body>
</html>
