<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Binodon - Post</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-decoration: none; }
        body { background: #fff; display: flex; justify-content: center; }
        .main-wrapper { width: 100%; max-width: 600px; min-height: 100vh; background: #fff; position: relative; border-left: 1px solid #eee; border-right: 1px solid #eee; padding-bottom: 0; }

        /* ‡¶π‡ßá‡¶°‡¶æ‡¶∞ */
        header { background: #1da1f2; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; color: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .logo-area { font-weight: 800; font-size: 20px; text-transform: uppercase; }
        .header-btn { background: white; color: #1da1f2; padding: 6px 15px; border-radius: 20px; font-weight: bold; font-size: 14px; margin-left: 10px; cursor: pointer; }

        /* ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏ ‡¶è‡¶∞‡¶ø‡ßü‡¶æ */
        .post-author-area { padding: 10px 15px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #e1e8ed; }
        .author-info { display: flex; align-items: center; gap: 10px; }
        .pfp { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; background: #ddd; }
        .pfp img { width: 100%; height: 100%; object-fit: cover; }
        .author-text h3 { font-size: 16px; margin: 0; color: #0f1419; }
        .author-text span { font-size: 14px; color: #536471; }
        .post-time { font-size: 13px; color: #536471; font-weight: bold; }

        .video-container { width: 100%; aspect-ratio: 16/9; background: #000; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-top: 5px; cursor: pointer; }
        .video-container img { width: 100%; height: 100%; object-fit: contain; }
        .play-btn-center { position: absolute; width: 60px; height: 60px; background: rgba(0,0,0,0.6); border-radius: 50%; border: 3px solid #fff; display: flex; align-items: center; justify-content: center; z-index: 5; pointer-events: none; }
        .play-btn-center::after { content: ''; border-left: 20px solid white; border-top: 12px solid transparent; border-bottom: 12px solid transparent; margin-left: 5px; }
        .main-video-spinner { display: none; position: absolute; width: 50px; height: 50px; border: 5px solid rgba(255, 255, 255, 0.3); border-top: 5px solid #fff; border-radius: 50%; animation: spin 1s linear infinite; z-index: 6; }
        .video-controls { position: absolute; bottom: 0; left: 0; width: 100%; padding: 10px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; display: flex; justify-content: space-between; font-size: 12px; z-index: 5; }

        .content-body { padding: 15px 15px 0 15px; }
        .article-title { font-size: 20px; font-weight: 800; margin-bottom: 15px; color: #0f1419; line-height: 1.3; }
        .article-para { font-size: 15px; line-height: 1.4; color: #1c1e21; margin-bottom: 12px; text-align: left; letter-spacing: -0.3px; }

        .download-btn { display: block; width: fit-content; margin: 20px auto; padding: 10px 20px; border-radius: 5px; font-weight: bold; font-size: 14px; text-align: center; color: white; cursor: pointer; text-transform: uppercase; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .download-btn:active { transform: scale(0.98); }

        /* ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏ ‡¶¨‡¶æ‡¶∞ */
        .stats-section { padding: 12px 0; margin-top: 15px; border-top: 1px solid #e1e8ed; border-bottom: 1px solid #e1e8ed; display: flex; align-items: center; background: #fff; }
        .stats-left { display: flex; align-items: center; gap: 20px; flex-grow: 1; overflow: hidden; }
        .view-stat { flex: 0 0 auto; display: flex; align-items: center; gap: 5px; font-weight: bold; font-size: 15px; color: #536471; }
        .view-stat i { font-size: 16px; }
        .like-stat-container { flex: 1 1 auto; display: flex; justify-content: center; }
        .love-btn { display: flex; align-items: center; gap: 5px; font-weight: bold; font-size: 15px; color: #536471; cursor: pointer; padding: 5px 10px; border-radius: 20px; transition: 0.2s; user-select: none; }
        .love-btn:active { background-color: rgba(224, 36, 94, 0.1); transform: scale(0.95); }
        .love-btn.liked { color: #e0245e; } .love-btn.liked i { font-weight: 900; } .love-btn i { font-size: 18px; }
        .share-icons { flex: 0 0 auto; display: flex; gap: 8px; }
        .share-icon { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; font-size: 13px; transition: 0.2s; }
        .share-icon:hover { opacity: 0.8; transform: scale(1.1); }

        /* ‡¶∞‡¶ø‡¶≤‡ßá‡¶ü‡ßá‡¶° ‡¶™‡ßã‡¶∏‡ßç‡¶ü (‡¶ï‡¶æ‡¶∞‡ßç‡¶°) */
        .related-section { background: #fff; margin-top: 0; }
        .related-header { padding: 15px; font-weight: 800; color: #536471; border-bottom: 1px solid #e1e8ed; text-transform: uppercase; background: #fff; }
        
        .post-card { 
            background: white; padding: 15px; border-bottom: 1px solid #e1e8ed; 
            display: flex; flex-direction: column; 
            gap: 6px; 
            opacity: 0; animation: fadeIn 0.5s forwards; 
        }
        @keyframes fadeIn { to { opacity: 1; } }

        .post-header { display: flex; gap: 10px; align-items: center; }
        .post-pfp { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; background: #ddd; }
        .post-pfp img { width: 100%; height: 100%; object-fit: cover; }
        .post-meta-text { display: flex; flex-direction: column; justify-content: center; }
        .name-row { display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
        
        .name-row h3 { font-size: 18px; font-weight: 800; color: #0f1419; margin: 0; }
        
        .post-username { font-size: 14px; color: #536471; }
        
        .time-ago { font-size: 15px; color: #536471; }
        .dot-separator { font-size: 15px; color: #536471; margin: 0 2px; }

        .clickable-area { cursor: pointer; }
        
        .post-title { 
            font-size: 18px; 
            font-weight: 700; 
            color: #0f1419; 
            margin-bottom: 8px; 
            margin-top: -3px; 
            line-height: 1.3; 
        }
        
        .post-excerpt { font-size: 15px; color: #0f1419; line-height: 1.4; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
        .read-more-text { color: #1da1f2; font-weight: 600; font-size: 14px; }
        .hashtags { color: #1d9bf0; font-size: 15px; margin-bottom: 10px; cursor: default; }

        .media-container { position: relative; width: 100%; border-radius: 12px; overflow: hidden; margin-top: 5px; display: block; max-height: 720px; cursor: pointer; background: #000; }
        .media-container img { width: 100%; height: auto; display: block; object-fit: contain; margin: 0 auto; max-height: 720px; }
        .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background-color: rgba(0, 0, 0, 0.6); border-radius: 50%; display: flex; justify-content: center; align-items: center; pointer-events: none; border: 2px solid rgba(255,255,255,0.8); }
        .play-icon::after { content: ''; display: block; width: 0; height: 0; border-left: 18px solid white; border-top: 11px solid transparent; border-bottom: 11px solid transparent; margin-left: 4px; }
        .duration-badge { position: absolute; bottom: 8px; right: 8px; background-color: rgba(0, 0, 0, 0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; pointer-events: none; z-index: 5; }

        .post-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; color: #536471; font-size: 16px; font-weight: 500; }
        .footer-left { display: flex; align-items: center; gap: 6px; }
        .footer-right { display: flex; align-items: center; gap: 20px; }
        
        .love-btn-rel { cursor: pointer; display: flex; align-items: center; gap: 5px; transition: all 0.2s; user-select: none; }
        .love-btn-rel:hover { color: #e0245e; background-color: rgba(224, 36, 94, 0.1); padding: 4px 8px; border-radius: 15px; margin: -4px -8px; }
        .love-btn-rel.liked { color: #e0245e !important; } .love-btn-rel.liked i { font-weight: 900; }
        .footer-share-btn { cursor: pointer; padding: 8px; border-radius: 50%; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; }
        .footer-share-btn:hover { background-color: rgba(0,0,0,0.05); }

        /* ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ */
        .site-footer { background-color: #fff; padding: 30px 20px; text-align: center; border-top: none; margin-top: 0; }
        .footer-links { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 15px; }
        .footer-links a { color: #536471; font-size: 14px; font-weight: 500; transition: color 0.2s; }
        .footer-links a:hover { color: #1da1f2; text-decoration: underline; }
        .footer-copyright { color: #536471; font-size: 13px; }
        .footer-copyright a { color: #1da1f2; font-weight: bold; }
        
        .spinner { width: 14px; height: 14px; border: 2px solid #ccc; border-top: 2px solid #000; border-radius: 50%; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .notification { position: fixed; top: 70px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 10px 20px; border-radius: 30px; z-index: 1002; opacity: 0; transition: 0.3s; pointer-events: none; }
        .notification.show { opacity: 1; }

        /* Infinite Scroll Sentinel */
        #sentinel { width: 100%; height: 50px; display: flex; align-items: center; justify-content: center; }
        .load-more-spinner { width: 24px; height: 24px; border: 3px solid #ccc; border-top: 3px solid #1da1f2; border-radius: 50%; animation: spin 1s linear infinite; display: none; }
        #sentinel.loading .load-more-spinner { display: block; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <header>
        <div class="logo-area">SECRET BINODON</div>
        <div>
            <span class="header-btn" onclick="window.location.href='https://www.example.com/signup'">Sign Up</span>
            <span class="header-btn" onclick="window.location.href='index.html'">Home</span>
        </div>
    </header>

    <div id="post-details-container">
        <div style="padding:40px; text-align:center; color:#666;">
            <span class="spinner" style="width:24px; height:24px;"></span> Loading post...
        </div>
    </div>

    <div class="related-section">
        <div class="related-header">RELATED POSTS</div>
        <div id="related-posts-container"></div>
        <div id="sentinel"><div class="load-more-spinner"></div></div>
    </div>

    <footer class="site-footer">
        <div class="footer-links">
            <a href="#" id="link-about">About</a>
            <a href="#" id="link-contact">Contact</a>
            <a href="#" id="link-privacy">Privacy Policy</a>
            <a href="#" id="link-terms">Terms of Service</a>
        </div>
        <div class="footer-copyright">
            Copyright ¬© 2025 <a href="index.html">SecretBinodon.com</a>. All rights reserved.
        </div>
    </footer>
    <div id="notification" class="notification"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    // ============================================
    //  ‡ßß. ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶á‡¶Æ‡ßá‡¶ú URL
    // ============================================
    const PERMANENT_PROFILE_IMAGE_URL = "https://raw.githubusercontent.com/style-grid/store/refs/heads/main/data/20251211_024630.jpg";

    const firebaseConfig = { apiKey: "AIzaSyCAsD8wucLsudzY5oNbiixLGyjN2apdV0Q", authDomain: "my-ad-analytics-4560a.firebaseapp.com", databaseURL: "https://my-ad-analytics-4560a-default-rtdb.firebaseio.com", projectId: "my-ad-analytics-4560a", storageBucket: "my-ad-analytics-4560a.firebasestorage.app", messagingSenderId: "104213283950", appId: "1:104213283950:web:b5a25ecd54df809625127f", measurementId: "G-WS7QSQ9H0Y" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const deviceId = localStorage.getItem('deviceId') || 'device-'+Date.now();

    // ============================================
    //  CONFIGURATION (‡¶∞‡¶ø‡¶≤‡ßá‡¶ü‡ßá‡¶° ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤)
    // ============================================
    const CONFIG = {
        GLOBAL_VIDEO_LINK: "https://www.google.com",
        // ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶è‡¶á ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶Æ‡¶æ‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßá ‡¶≤‡ßã‡¶° ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶®‡¶ø‡¶Ø‡¶º‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®:
        INITIAL_LOAD: 10,
        BATCH_SIZE: 10,    
        footer: { about: "#", contact: "#", privacy: "#", terms: "#" }
    };

    document.getElementById('link-about').href = CONFIG.footer.about;
    document.getElementById('link-contact').href = CONFIG.footer.contact;
    document.getElementById('link-privacy').href = CONFIG.footer.privacy;
    document.getElementById('link-terms').href = CONFIG.footer.terms;

    // ‡¶ü‡¶æ‡¶á‡¶Æ-‡¶¨‡ßá‡¶∏‡¶° ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤
    let allRelatedPosts = []; // ‡¶Æ‡ßã‡¶ü ‡¶™‡ßã‡¶∏‡ßç‡¶ü
    let currentIndex = 0; // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡¶§‡¶¶‡ßÇ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá
    let postsByTimeChunk = {}; // ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶ï‡¶æ‡¶†‡¶æ‡¶Æ‡ßã
    let currentChunkIndex = 0; // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶® ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶ñ‡¶£‡ßç‡¶°‡ßá‡¶∞ ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá (‡¶Ø‡ßá‡¶Æ‡¶®: 1 hour, 2 hours, Day 1)
    let remainingInChunk = []; // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶™‡ßã‡¶∏‡ßç‡¶ü

    let anchorPostTime; // ‡¶Ø‡ßá ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶§‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ü‡¶æ‡¶á‡¶Æ
    let observer;
    
    // --- ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶∏ ---
    function getRandomColor() { const c=['#e0245e','#17bf63','#1da1f2','#ffad1f','#794bc4']; return c[Math.floor(Math.random()*c.length)]; }
    function formatCount(n) { if(!n) return 0; return n >= 1000000 ? (n/1000000).toFixed(1)+'M' : n >= 1000 ? (n/1000).toFixed(1)+'K' : n; }
    function timeAgo(d) { const s=Math.floor((new Date()-new Date(d))/1000); let i=s/31536000; if(i>1)return Math.floor(i)+"y ago"; i=s/86400; if(i>1)return Math.floor(i)+"d ago"; i=s/3600; if(i>1)return Math.floor(i)+"h ago"; return "Just now"; }
    function formatDate(d) { return new Date(d).toLocaleDateString('en-US', { year:'numeric', month:'short', day:'numeric' }); }
    function showNotification(msg) { const n=document.getElementById('notification'); n.innerText=msg; n.classList.add('show'); setTimeout(()=>n.classList.remove('show'),3000); }

    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('id');
    
    /**
     * ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ï‡ßÄ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá (‡¶Ø‡ßá‡¶Æ‡¶®: 'h-1', 'h-2', 'd-1', 'd-2')
     */
    function getTimeChunkKey(postTime, anchorTime) {
        const diffInSeconds = Math.floor((anchorTime - postTime) / 1000);
        const diffInHours = diffInSeconds / 3600;
        const diffInDays = diffInSeconds / 86400;

        if (diffInHours < 24) {
            const hoursAgo = Math.floor(diffInHours);
            return `h-${hoursAgo + 1}`; // ‡ßß ‡¶ò‡¶£‡ßç‡¶ü‡¶æ, ‡ß® ‡¶ò‡¶£‡ßç‡¶ü‡¶æ... ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ
        } else {
            const daysAgo = Math.floor(diffInDays);
            return `d-${daysAgo}`; // ‡ßß ‡¶¶‡¶ø‡¶®, ‡ß® ‡¶¶‡¶ø‡¶®...
        }
    }


    /**
     * ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶ó‡ßã‡¶õ‡¶æ‡¶Ø‡¶º
     */
    async function init() {
        try {
            const res = await fetch('posts.json');
            if(!res.ok) throw new Error("Failed to load posts data.");
            const posts = await res.json();
            
            const mainPost = posts.find(p => p.id === postId) || posts[0];
            if (!mainPost) throw new Error("Post not found.");

            renderMainPost(mainPost);
            setupFirebaseForMainPost(mainPost.id);
            
            // ‡¶∞‡¶ø‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡¶ø:
            anchorPostTime = new Date(mainPost.uploadTime).getTime();
            
            // ‡ßß. ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶¨‡¶æ‡¶¶‡ßá ‡¶™‡ßÅ‡¶∞‡ßã‡¶®‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶∏‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ
            const historicalPosts = posts
                .filter(p => p.id !== mainPost.id && new Date(p.uploadTime).getTime() < anchorPostTime)
                .sort((a, b) => new Date(a.uploadTime).getTime() - new Date(b.uploadTime).getTime()); // ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶§‡ßÅ‡¶®

            // ‡ß®. ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡ßã‡¶ï‡ßá ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶ï‡¶∞‡¶æ
            postsByTimeChunk = historicalPosts.reduce((acc, post) => {
                const postTime = new Date(post.uploadTime).getTime();
                const key = getTimeChunkKey(postTime, anchorPostTime);
                if (!acc[key]) acc[key] = [];
                acc[key].push(post);
                return acc;
            }, {});

            // ‡ß©. ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶ñ‡¶£‡ßç‡¶°‡ßá‡¶∞ Key ‡¶ó‡ßÅ‡¶≤‡ßã‡¶ï‡ßá ‡¶∏‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ (h-1, h-2, ... d-1, d-2...)
            const sortedKeys = Object.keys(postsByTimeChunk).sort((a, b) => {
                const aType = a.split('-')[0], aNum = parseInt(a.split('-')[1]);
                const bType = b.split('-')[0], bNum = parseInt(b.split('-')[1]);
                
                if (aType === 'h' && bType === 'd') return -1;
                if (aType === 'd' && bType === 'h') return 1;
                return aNum - bNum;
            });

            allRelatedPosts = sortedKeys; // ‡¶è‡¶ñ‡¶® ‡¶è‡¶ü‡¶ø Time Chunk-‡¶è‡¶∞ Key ‡¶è‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá
            
            // Initial Batch Load
            loadNextBatch();

            // Setup Infinite Scroll Observer
            setupObserver();

        } catch (e) { 
            document.getElementById('post-details-container').innerHTML = `<div style="padding:20px;text-align:center;color:red;">Error loading post: ${e.message}</div>`; 
        }
    }

    function renderMainPost(post) {
        let content = `<h1 class="article-title">${post.title}</h1>`;
        const totalPara = post.paragraphs.length;
        
        // ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶Ö‡¶ï‡ßç‡¶∑‡¶§
        post.paragraphs.forEach((p, i) => {
            content += `<p class="article-para">${p}</p>`;
            if (totalPara <= 2) {
                if (i === 0 && post.downloadLink1) content += `<a href="${post.downloadLink1}" class="download-btn" style="background:${getRandomColor()}">DOWNLOAD FULL VIDEO</a>`;
            } else {
                if (i === 0 && post.downloadLink1) content += `<a href="${post.downloadLink1}" class="download-btn" style="background:${getRandomColor()}">DOWNLOAD FULL VIDEO</a>`;
                if (i === totalPara - 2 && post.downloadLink2) content += `<a href="${post.downloadLink2}" class="download-btn" style="background:${getRandomColor()}">DOWNLOAD FULL VIDEO</a>`;
            }
        });

        document.getElementById('post-details-container').innerHTML = `
            <div class="post-author-area">
                <div class="author-info">
                    <div class="pfp"><img src="${PERMANENT_PROFILE_IMAGE_URL}"></div>
                    <div class="author-text"><h3>Secret Binodon</h3><span>@SecretBinodon</span></div>
                </div>
                <div class="post-time">${timeAgo(post.uploadTime)}</div>
            </div>
            <div class="video-container" onclick="handleVideoClick()"><img src="${post.mediaImage}"><div class="play-btn-center" id="main-play-btn"></div><div class="main-video-spinner" id="main-spinner"></div><div class="video-controls"><span>${post.videoDuration}</span><span><i class="fa-solid fa-volume-high"></i> HD</span></div></div>
            <div class="content-body">${content}<div class="stats-section"><div class="stats-left"><div class="view-stat"><i class="fa-solid fa-chart-simple"></i> <span id="view-cnt">...</span> Views</div><div class="like-stat-container"><div class="love-btn"><i class="fa-regular fa-heart"></i> <span id="like-cnt">...</span> Likes</div></div></div><div class="share-icons"><div class="share-icon" style="background:#1877f2" onclick="share('fb', '${post.title}')"><i class="fa-brands fa-facebook-f"></i></div><div class="share-icon" style="background:#0084ff" onclick="share('msg', '${post.title}')"><i class="fa-brands fa-facebook-messenger"></i></div><div class="share-icon" style="background:#25d366" onclick="share('wa', '${post.title}')"><i class="fa-brands fa-whatsapp"></i></div><div class="share-icon" style="background:#1da1f2" onclick="share('tw', '${post.title}')"><i class="fa-brands fa-twitter"></i></div><div class="share-icon" style="background:#0088cc" onclick="share('tg', '${post.title}')"><i class="fa-brands fa-telegram"></i></div></div></div></div>`;
    }

    // --- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ-‡¶¨‡ßá‡¶∏‡¶° ‡¶á‡¶®‡¶´‡¶ø‡¶®‡¶ø‡¶ü ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶≤‡¶ú‡¶ø‡¶ï ---
    function loadNextBatch() {
        const container = document.getElementById('related-posts-container');
        const sentinel = document.getElementById('sentinel');
        
        // ‡¶Ø‡¶ñ‡¶® ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ô‡ßç‡¶ï (h-1, h-2, d-1...) ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶¨‡ßá
        if (currentChunkIndex >= allRelatedPosts.length && remainingInChunk.length === 0) {
            sentinel.style.display = 'none';
            return;
        }

        sentinel.classList.add('loading');
        let postsToLoad = [];
        let neededCount = CONFIG.BATCH_SIZE;

        // ‡¶ß‡¶æ‡¶™ ‡ßß: ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
        if (remainingInChunk.length > 0) {
            const takeFromRemaining = Math.min(neededCount, remainingInChunk.length);
            postsToLoad.push(...remainingInChunk.splice(0, takeFromRemaining));
            neededCount -= takeFromRemaining;
        }

        // ‡¶ß‡¶æ‡¶™ ‡ß®: ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ô‡ßç‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ (‡¶Ø‡¶¶‡¶ø ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶® ‡¶π‡¶Ø‡¶º)
        while (neededCount > 0 && currentChunkIndex < allRelatedPosts.length) {
            const chunkKey = allRelatedPosts[currentChunkIndex];
            const currentChunkPosts = postsByTimeChunk[chunkKey];

            const takeFromChunk = Math.min(neededCount, currentChunkPosts.length);
            postsToLoad.push(...currentChunkPosts.splice(0, takeFromChunk));
            neededCount -= takeFromChunk;

            // ‡¶Ø‡¶¶‡¶ø ‡¶è‡¶á ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ô‡ßç‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶Ø‡¶º, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶™‡¶∞‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ô‡ßç‡¶ï‡ßá ‡¶Ø‡¶æ‡¶ì
            if (currentChunkPosts.length === 0) {
                currentChunkIndex++;
            } else if (neededCount === 0) {
                // ‡¶Ø‡¶¶‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶Ø‡¶º ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶è‡¶á ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ô‡ßç‡¶ï‡ßá ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶¨‡ßá ‡¶§‡¶æ ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
                remainingInChunk = currentChunkPosts;
            }
        }
        
        // DOM ‡¶§‡ßà‡¶∞‡¶ø ‡¶ì ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ
        postsToLoad.forEach(post => {
            let excerpt = post.paragraphs[0].substring(0, 200) + "...";
            const safeTitle = post.title.replace(/'/g, "\\'");
            
            const cardWrapper = document.createElement('div');
            cardWrapper.innerHTML = `
                <div class="post-card" data-id="${post.id}">
                    <div class="post-header">
                        <div class="post-pfp"><img src="${PERMANENT_PROFILE_IMAGE_URL}" loading="lazy"></div>
                        <div class="post-meta-text"><div class="name-row"><h3>Secret Binodon</h3><span class="post-username">@SecretBinodon</span><span class="dot-separator">¬∑</span><span class="time-ago">${timeAgo(post.uploadTime)}</span></div></div>
                    </div>
                    <div class="clickable-area" onclick="openPost('${post.id}')"><div class="post-title">${post.title}</div><div class="post-excerpt">${excerpt} <span class="read-more-text">See more</span></div></div>
                    <div class="hashtags">${post.hashtags}</div>
                    <div class="clickable-area" onclick="openPost('${post.id}')"><div class="media-container"><img src="${post.mediaImage}" loading="lazy"><div class="play-icon"></div><div class="duration-badge">${post.videoDuration}</div></div></div>
                    <div class="post-footer"><div class="footer-left"><i class="fa-solid fa-chart-simple"></i> <span class="count-text view-count-rel">...</span> <span class="label-text">Views</span></div><div class="footer-right"><div class="love-btn-rel"><i class="fa-regular fa-heart"></i> <span class="count-text like-count-rel">...</span> <span class="label-text">Likes</span></div><div class="post-date-display">${formatDate(post.uploadTime)}</div><div class="footer-share-btn" onclick="sharePost('${post.id}', '${safeTitle}')"><i class="fa-solid fa-share-from-square"></i></div></div></div>
                </div>`;
            
            const newCard = cardWrapper.firstElementChild;
            container.appendChild(newCard);
            setupFirebaseForSingleCard(newCard, post.id);
        });

        sentinel.classList.remove('loading');
        // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶§‡ßá ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞ ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶Ø‡¶º
        if (currentChunkIndex >= allRelatedPosts.length && remainingInChunk.length === 0) {
            sentinel.style.display = 'none';
        }
    }

    function setupObserver() {
        const sentinel = document.getElementById('sentinel');
        observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting) {
                setTimeout(() => loadNextBatch(), 500); 
            }
        }, { rootMargin: '100px' });
        observer.observe(sentinel);
    }

    // --- FIREBASE LOGIC (OPTIMIZED) ---
    function setupFirebaseForMainPost(id) {
        setDoc(doc(db, "views", id), { count: increment(1) }, { merge: true });
        onSnapshot(doc(db, "views", id), s => document.getElementById('view-cnt').innerText = formatCount(s.data()?.count || 0));
        const lRef = doc(db, "loves", id), uRef = doc(db, `loves/${id}/users`, deviceId), lBtn = document.querySelector('.love-btn');
        onSnapshot(lRef, s => document.getElementById('like-cnt').innerText = formatCount(s.data()?.count || 0));
        getDoc(uRef).then(s => { if(s.exists()) { lBtn.classList.add('liked'); lBtn.querySelector('i').classList.replace('fa-regular','fa-solid'); } });
        lBtn.addEventListener('click', async () => { if((await getDoc(uRef)).exists()) showNotification("Already Liked! ‚ù§Ô∏è"); else { lBtn.classList.add('liked'); lBtn.querySelector('i').classList.replace('fa-regular','fa-solid'); await setDoc(lRef, { count: increment(1) }, { merge: true }); await setDoc(uRef, { t: new Date() }); showNotification("Liked! ‚ù§Ô∏è"); } });
    }

    function setupFirebaseForSingleCard(card, id) {
        const vEl = card.querySelector('.view-count-rel'), lEl = card.querySelector('.like-count-rel'), lBtn = card.querySelector('.love-btn-rel');
        onSnapshot(doc(db, "views", id), s => vEl.innerText = formatCount(s.data()?.count || 0));
        const lRef = doc(db, "loves", id), uRef = doc(db, `loves/${id}/users`, deviceId);
        onSnapshot(lRef, s => lEl.innerText = formatCount(s.data()?.count || 0));
        getDoc(uRef).then(s => { if(s.exists()) { lBtn.classList.add('liked'); lBtn.querySelector('i').classList.replace('fa-regular','fa-solid'); } });
        lBtn.addEventListener('click', async () => { if((await getDoc(uRef)).exists()) showNotification("Already Liked! ‚ù§Ô∏è"); else { lBtn.classList.add('liked'); lBtn.querySelector('i').classList.replace('fa-regular','fa-solid'); await setDoc(lRef, { count: increment(1) }, { merge: true }); await setDoc(uRef, { t: new Date() }); showNotification("Liked! ‚ù§Ô∏è"); } });
    }

    // --- GLOBAL FUNCTIONS ---
    window.handleVideoClick = function() {
        const p = document.getElementById('main-play-btn'), s = document.getElementById('main-spinner');
        if(p) p.style.display = 'none'; if(s) s.style.display = 'block';
        setTimeout(() => { window.location.href = CONFIG.GLOBAL_VIDEO_LINK; }, 100); 
    }
    window.addEventListener('pageshow', () => {
        const p = document.getElementById('main-play-btn'), s = document.getElementById('main-spinner');
        if(p) p.style.display = 'flex'; if(s) s.style.display = 'none';
    });

    window.openPost = (id) => window.location.href = `post.html?id=${id}`;
    window.sharePost = (id, title) => { const url = window.location.origin + `/post.html?id=${id}`; if (navigator.share) { navigator.share({ title: title, text: title, url: url }).catch((e) => console.log('Share failed', e)); } else { navigator.clipboard.writeText(url); showNotification("Link copied! üìã"); } }

    window.share = (platform, title) => {
        const url = encodeURIComponent(window.location.href);
        const text = encodeURIComponent(title);
        if (platform === 'msg') {
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            if (isMobile) window.location.href = `fb-messenger://share/?link=${url}`;
            else window.open(`https://www.facebook.com/dialog/send?link=${url}&app_id=123456789&redirect_uri=${url}`, '_blank');
        } else {
            let link = '';
            if(platform === 'fb') link = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
            else if(platform === 'wa') link = `https://wa.me/?text=${text}%20${url}`;
            else if(platform === 'tw') link = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
            else if(platform === 'tg') link = `https://t.me/share/url?url=${url}&text=${text}`;
            window.open(link, '_blank');
        }
    }

    init();
</script>
</body>
</html>
